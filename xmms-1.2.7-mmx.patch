diff -urN xmms-1.2.7.orig/Input/mpg123/Makefile.am xmms-1.2.7/Input/mpg123/Makefile.am
--- xmms-1.2.7.orig/Input/mpg123/Makefile.am	Wed Sep 19 21:17:12 2001
+++ xmms-1.2.7/Input/mpg123/Makefile.am	Wed Mar  6 00:55:41 2002
@@ -15,9 +15,9 @@
 
 if ARCH_X86
 
-if USE_3DNOW
+if USE_SIMD
 
-EXTRA_SRC = decode_i386.c decode_i586.s decode_3dnow.s dct64_i386.c dct64_3dnow.s dct36_3dnow.s getcpuflags.s
+EXTRA_SRC = decode_i386.c decode_i586.s decode_3dnow.s dct64_i386.c dct64_3dnow.s dct36_3dnow.s check_x86simd.s dct64_MMX.s decode_MMX.s tabinit_MMX.s
 else
 
 EXTRA_SRC = decode_i386.c decode_i586.s dct64_i386.c
@@ -30,7 +30,7 @@
 
 endif
 
-EXTRA_DIST = decode_i386.c decode_i586.s dct64_i386.c getbits.c decode.c dct64.c decode_3dnow.s dct64_3dnow.s dct36_3dnow.s getcpuflags.s
+EXTRA_DIST = decode_i386.c decode_i586.s dct64_i386.c getbits.c decode.c dct64.c decode_3dnow.s dct64_3dnow.s dct36_3dnow.s check_x86simd.s dct64_MMX.s decode_MMX.s tabinit_MMX.s
 
 libmpg123_la_SOURCES = $(COMMON_SRC) $(EXTRA_SRC)
 libmpg123_la_LDFLAGS = @PLUGIN_LDFLAGS@
diff -urN xmms-1.2.7.orig/Input/mpg123/Makefile.in xmms-1.2.7/Input/mpg123/Makefile.in
--- xmms-1.2.7.orig/Input/mpg123/Makefile.in	Tue Mar  5 06:58:39 2002
+++ xmms-1.2.7/Input/mpg123/Makefile.in	Wed Mar  6 01:04:39 2002
@@ -137,7 +137,7 @@
 SIDPLAY_LIBS = @SIDPLAY_LIBS@
 SM_LIBS = @SM_LIBS@
 STRIP = @STRIP@
-USE_3DNOW_TRUE = @USE_3DNOW_TRUE@
+USE_SIMD_TRUE = @USE_SIMD_TRUE@
 USE_INCLUDED_LIBINTL = @USE_INCLUDED_LIBINTL@
 USE_NLS = @USE_NLS@
 VERSION = @VERSION@
@@ -175,11 +175,11 @@
 id3_frame_url.c id3_header.h id3_tag.c
 
 
-@ARCH_X86_TRUE@@USE_3DNOW_TRUE@EXTRA_SRC = @ARCH_X86_TRUE@@USE_3DNOW_TRUE@decode_i386.c decode_i586.s decode_3dnow.s dct64_i386.c dct64_3dnow.s dct36_3dnow.s getcpuflags.s
-@ARCH_X86_TRUE@@USE_3DNOW_FALSE@EXTRA_SRC = @ARCH_X86_TRUE@@USE_3DNOW_FALSE@decode_i386.c decode_i586.s dct64_i386.c
+@ARCH_X86_TRUE@@USE_SIMD_TRUE@EXTRA_SRC = @ARCH_X86_TRUE@@USE_SIMD_TRUE@decode_i386.c decode_i586.s decode_3dnow.s dct64_i386.c dct64_3dnow.s dct36_3dnow.s check_x86simd.s dct64_MMX.s decode_MMX.s tabinit_MMX.s
+@ARCH_X86_TRUE@@USE_SIMD_FALSE@EXTRA_SRC = @ARCH_X86_TRUE@@USE_SIMD_FALSE@decode_i386.c decode_i586.s dct64_i386.c
 @ARCH_X86_FALSE@EXTRA_SRC = @ARCH_X86_FALSE@decode.c dct64.c
 
-EXTRA_DIST = decode_i386.c decode_i586.s dct64_i386.c getbits.c decode.c dct64.c decode_3dnow.s dct64_3dnow.s dct36_3dnow.s getcpuflags.s
+EXTRA_DIST = decode_i386.c decode_i586.s dct64_i386.c getbits.c decode.c dct64.c decode_3dnow.s dct64_3dnow.s dct36_3dnow.s check_x86simd.s dct64_MMX.s decode_MMX.s tabinit_MMX.s
 
 libmpg123_la_SOURCES = $(COMMON_SRC) $(EXTRA_SRC)
 libmpg123_la_LDFLAGS = @PLUGIN_LDFLAGS@
@@ -196,46 +196,47 @@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 libmpg123_la_DEPENDENCIES = 
-@ARCH_X86_FALSE@@USE_3DNOW_TRUE@libmpg123_la_OBJECTS =  mpg123.lo \
-@ARCH_X86_FALSE@@USE_3DNOW_TRUE@configure.lo fileinfo.lo common.lo \
-@ARCH_X86_FALSE@@USE_3DNOW_TRUE@decode_2to1.lo decode_4to1.lo \
-@ARCH_X86_FALSE@@USE_3DNOW_TRUE@decode_ntom.lo layer1.lo layer2.lo \
-@ARCH_X86_FALSE@@USE_3DNOW_TRUE@layer3.lo tabinit.lo equalizer.lo \
-@ARCH_X86_FALSE@@USE_3DNOW_TRUE@http.lo dxhead.lo id3.lo id3_frame.lo \
-@ARCH_X86_FALSE@@USE_3DNOW_TRUE@id3_frame_content.lo id3_frame_text.lo \
-@ARCH_X86_FALSE@@USE_3DNOW_TRUE@id3_frame_url.lo id3_tag.lo decode.lo \
-@ARCH_X86_FALSE@@USE_3DNOW_TRUE@dct64.lo
-@ARCH_X86_FALSE@@USE_3DNOW_FALSE@libmpg123_la_OBJECTS =  mpg123.lo \
-@ARCH_X86_FALSE@@USE_3DNOW_FALSE@configure.lo fileinfo.lo common.lo \
-@ARCH_X86_FALSE@@USE_3DNOW_FALSE@decode_2to1.lo decode_4to1.lo \
-@ARCH_X86_FALSE@@USE_3DNOW_FALSE@decode_ntom.lo layer1.lo layer2.lo \
-@ARCH_X86_FALSE@@USE_3DNOW_FALSE@layer3.lo tabinit.lo equalizer.lo \
-@ARCH_X86_FALSE@@USE_3DNOW_FALSE@http.lo dxhead.lo id3.lo id3_frame.lo \
-@ARCH_X86_FALSE@@USE_3DNOW_FALSE@id3_frame_content.lo id3_frame_text.lo \
-@ARCH_X86_FALSE@@USE_3DNOW_FALSE@id3_frame_url.lo id3_tag.lo decode.lo \
-@ARCH_X86_FALSE@@USE_3DNOW_FALSE@dct64.lo
-@ARCH_X86_TRUE@@USE_3DNOW_TRUE@libmpg123_la_OBJECTS =  mpg123.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_TRUE@configure.lo fileinfo.lo common.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_TRUE@decode_2to1.lo decode_4to1.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_TRUE@decode_ntom.lo layer1.lo layer2.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_TRUE@layer3.lo tabinit.lo equalizer.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_TRUE@http.lo dxhead.lo id3.lo id3_frame.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_TRUE@id3_frame_content.lo id3_frame_text.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_TRUE@id3_frame_url.lo id3_tag.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_TRUE@decode_i386.lo decode_i586.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_TRUE@decode_3dnow.lo dct64_i386.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_TRUE@dct64_3dnow.lo dct36_3dnow.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_TRUE@getcpuflags.lo
-@ARCH_X86_TRUE@@USE_3DNOW_FALSE@libmpg123_la_OBJECTS =  mpg123.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_FALSE@configure.lo fileinfo.lo common.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_FALSE@decode_2to1.lo decode_4to1.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_FALSE@decode_ntom.lo layer1.lo layer2.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_FALSE@layer3.lo tabinit.lo equalizer.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_FALSE@http.lo dxhead.lo id3.lo id3_frame.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_FALSE@id3_frame_content.lo id3_frame_text.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_FALSE@id3_frame_url.lo id3_tag.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_FALSE@decode_i386.lo decode_i586.lo \
-@ARCH_X86_TRUE@@USE_3DNOW_FALSE@dct64_i386.lo
+@ARCH_X86_FALSE@@USE_SIMD_TRUE@libmpg123_la_OBJECTS =  mpg123.lo \
+@ARCH_X86_FALSE@@USE_SIMD_TRUE@configure.lo fileinfo.lo common.lo \
+@ARCH_X86_FALSE@@USE_SIMD_TRUE@decode_2to1.lo decode_4to1.lo \
+@ARCH_X86_FALSE@@USE_SIMD_TRUE@decode_ntom.lo layer1.lo layer2.lo \
+@ARCH_X86_FALSE@@USE_SIMD_TRUE@layer3.lo tabinit.lo equalizer.lo \
+@ARCH_X86_FALSE@@USE_SIMD_TRUE@http.lo dxhead.lo id3.lo id3_frame.lo \
+@ARCH_X86_FALSE@@USE_SIMD_TRUE@id3_frame_content.lo id3_frame_text.lo \
+@ARCH_X86_FALSE@@USE_SIMD_TRUE@id3_frame_url.lo id3_tag.lo decode.lo \
+@ARCH_X86_FALSE@@USE_SIMD_TRUE@dct64.lo
+@ARCH_X86_FALSE@@USE_SIMD_FALSE@libmpg123_la_OBJECTS =  mpg123.lo \
+@ARCH_X86_FALSE@@USE_SIMD_FALSE@configure.lo fileinfo.lo common.lo \
+@ARCH_X86_FALSE@@USE_SIMD_FALSE@decode_2to1.lo decode_4to1.lo \
+@ARCH_X86_FALSE@@USE_SIMD_FALSE@decode_ntom.lo layer1.lo layer2.lo \
+@ARCH_X86_FALSE@@USE_SIMD_FALSE@layer3.lo tabinit.lo equalizer.lo \
+@ARCH_X86_FALSE@@USE_SIMD_FALSE@http.lo dxhead.lo id3.lo id3_frame.lo \
+@ARCH_X86_FALSE@@USE_SIMD_FALSE@id3_frame_content.lo id3_frame_text.lo \
+@ARCH_X86_FALSE@@USE_SIMD_FALSE@id3_frame_url.lo id3_tag.lo decode.lo \
+@ARCH_X86_FALSE@@USE_SIMD_FALSE@dct64.lo
+@ARCH_X86_TRUE@@USE_SIMD_TRUE@libmpg123_la_OBJECTS =  mpg123.lo \
+@ARCH_X86_TRUE@@USE_SIMD_TRUE@configure.lo fileinfo.lo common.lo \
+@ARCH_X86_TRUE@@USE_SIMD_TRUE@decode_2to1.lo decode_4to1.lo \
+@ARCH_X86_TRUE@@USE_SIMD_TRUE@decode_ntom.lo layer1.lo layer2.lo \
+@ARCH_X86_TRUE@@USE_SIMD_TRUE@layer3.lo tabinit.lo equalizer.lo \
+@ARCH_X86_TRUE@@USE_SIMD_TRUE@http.lo dxhead.lo id3.lo id3_frame.lo \
+@ARCH_X86_TRUE@@USE_SIMD_TRUE@id3_frame_content.lo id3_frame_text.lo \
+@ARCH_X86_TRUE@@USE_SIMD_TRUE@id3_frame_url.lo id3_tag.lo \
+@ARCH_X86_TRUE@@USE_SIMD_TRUE@decode_i386.lo decode_i586.lo \
+@ARCH_X86_TRUE@@USE_SIMD_TRUE@decode_3dnow.lo dct64_i386.lo \
+@ARCH_X86_TRUE@@USE_SIMD_TRUE@dct64_3dnow.lo dct36_3dnow.lo \
+@ARCH_X86_TRUE@@USE_SIMD_TRUE@dct64_MMX.lo decode_MMX.lo tabinit_MMX.lo \
+@ARCH_X86_TRUE@@USE_SIMD_TRUE@check_x86simd.lo
+@ARCH_X86_TRUE@@USE_SIMD_FALSE@libmpg123_la_OBJECTS =  mpg123.lo \
+@ARCH_X86_TRUE@@USE_SIMD_FALSE@configure.lo fileinfo.lo common.lo \
+@ARCH_X86_TRUE@@USE_SIMD_FALSE@decode_2to1.lo decode_4to1.lo \
+@ARCH_X86_TRUE@@USE_SIMD_FALSE@decode_ntom.lo layer1.lo layer2.lo \
+@ARCH_X86_TRUE@@USE_SIMD_FALSE@layer3.lo tabinit.lo equalizer.lo \
+@ARCH_X86_TRUE@@USE_SIMD_FALSE@http.lo dxhead.lo id3.lo id3_frame.lo \
+@ARCH_X86_TRUE@@USE_SIMD_FALSE@id3_frame_content.lo id3_frame_text.lo \
+@ARCH_X86_TRUE@@USE_SIMD_FALSE@id3_frame_url.lo id3_tag.lo \
+@ARCH_X86_TRUE@@USE_SIMD_FALSE@decode_i386.lo decode_i586.lo \
+@ARCH_X86_TRUE@@USE_SIMD_FALSE@dct64_i386.lo
 CFLAGS = @CFLAGS@
 COMPILE = $(CC) $(DEFS) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 LTCOMPILE = $(LIBTOOL) --mode=compile $(CC) $(DEFS) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
diff -urN xmms-1.2.7.orig/Input/mpg123/check_x86simd.h xmms-1.2.7/Input/mpg123/check_x86simd.h
--- xmms-1.2.7.orig/Input/mpg123/check_x86simd.h	Thu Jan  1 09:00:00 1970
+++ xmms-1.2.7/Input/mpg123/check_x86simd.h	Wed Mar  6 00:55:41 2002
@@ -0,0 +1,11 @@
+#define FLAG_MMX	0x00800000
+#define FLAG_3DNOW	0x80000000
+#define FLAG_SSE	0x02000000
+
+#define CPU_HAS_NOSIMD      0
+#define CPU_HAS_MMX		1
+#define CPU_HAS_3DNOW	2
+#define CPU_HAS_SSE		3
+
+extern int mpg123_check_x86simd(void);
+
diff -urN xmms-1.2.7.orig/Input/mpg123/check_x86simd.s xmms-1.2.7/Input/mpg123/check_x86simd.s
--- xmms-1.2.7.orig/Input/mpg123/check_x86simd.s	Thu Jan  1 09:00:00 1970
+++ xmms-1.2.7/Input/mpg123/check_x86simd.s	Wed Mar  6 00:55:41 2002
@@ -0,0 +1,167 @@
+/
+/ check_x86simd.s - detect CPU has SSE/MMX/3DNow!
+/    Osamu Kayasono <jacobi@jcom.home.ne.jp>
+/    Mar 3, 2001
+/ 
+/ convert assembler code with 'gcc -S', because of compilation problems
+/
+	.file	"check_x86simd.c"
+	.version	"02.01"
+gcc2_compiled.:
+.text
+.globl cpuid
+	.type	 cpuid,@function
+cpuid:
+	pushl %ebp
+	movl %esp,%ebp
+	subl $28,%esp
+	pushl %edi
+	pushl %esi
+	pushl %ebx
+	movl 8(%ebp),%eax
+#APP
+	cpuid
+#NO_APP
+	movl %eax,-4(%ebp)
+	movl %ebx,-8(%ebp)
+	movl %ecx,-20(%ebp)
+	movl %edx,%esi
+	movl -4(%ebp),%eax
+	movl %eax,-12(%ebp)
+	movl -12(%ebp),%ecx
+	movl 12(%ebp),%edx
+	movl %ecx,(%edx)
+	movl -8(%ebp),%ebx
+	movl %ebx,-16(%ebp)
+	movl -16(%ebp),%edx
+	movl 16(%ebp),%eax
+	movl %edx,(%eax)
+	movl -20(%ebp),%edi
+	movl 20(%ebp),%ecx
+	movl %edi,(%ecx)
+	movl %esi,%esi
+	movl 24(%ebp),%ebx
+	movl %esi,(%ebx)
+.L2:
+	leal -40(%ebp),%esp
+	popl %ebx
+	popl %esi
+	popl %edi
+	movl %ebp,%esp
+	popl %ebp
+	ret
+.Lfe1:
+	.size	 cpuid,.Lfe1-cpuid
+.globl mpg123_check_x86simd
+	.type	 mpg123_check_x86simd,@function
+mpg123_check_x86simd:
+	pushl %ebp
+	movl %esp,%ebp
+	subl $40,%esp
+	addl $-12,%esp
+	leal -20(%ebp),%eax
+	leal 16(%eax),%edx
+	pushl %edx
+	leal -20(%ebp),%eax
+	leal 12(%eax),%edx
+	pushl %edx
+	leal -20(%ebp),%eax
+	leal 8(%eax),%edx
+	pushl %edx
+	leal -20(%ebp),%eax
+	leal 4(%eax),%edx
+	pushl %edx
+	pushl $0
+	call cpuid
+	addl $32,%esp
+	cmpl $0,-16(%ebp)
+	jg .L4
+	xorl %eax,%eax
+	jmp .L3
+	.p2align 4,,7
+.L4:
+	addl $-12,%esp
+	leal -20(%ebp),%eax
+	leal 16(%eax),%edx
+	pushl %edx
+	leal -20(%ebp),%eax
+	leal 12(%eax),%edx
+	pushl %edx
+	leal -20(%ebp),%eax
+	leal 8(%eax),%edx
+	pushl %edx
+	leal -20(%ebp),%eax
+	leal 4(%eax),%edx
+	pushl %edx
+//
+// disable SSE detection (SSE decoder is not implemented)	
+//
+//	pushl $1
+//	call cpuid
+//	addl $32,%esp
+//	movl -4(%ebp),%eax
+//	andl $33554432,%eax
+//	testl %eax,%eax
+//	je .L5
+//	movl $3,%eax
+//	jmp .L3
+//	.p2align 4,,7
+//.L5:
+//	addl $-12,%esp
+//	leal -20(%ebp),%eax
+//	leal 16(%eax),%edx
+//	pushl %edx
+//	leal -20(%ebp),%eax
+//	leal 12(%eax),%edx
+//	pushl %edx
+//	leal -20(%ebp),%eax
+//	leal 8(%eax),%edx
+//	pushl %edx
+//	leal -20(%ebp),%eax
+//	leal 4(%eax),%edx
+//	pushl %edx
+	pushl $-2147483647
+	call cpuid
+	addl $32,%esp
+	movl -4(%ebp),%eax
+	andl $-2147483648,%eax
+	testl %eax,%eax
+	je .L6
+	movl $2,%eax
+	jmp .L3
+	.p2align 4,,7
+.L6:
+	addl $-12,%esp
+	leal -20(%ebp),%eax
+	leal 16(%eax),%edx
+	pushl %edx
+	leal -20(%ebp),%eax
+	leal 12(%eax),%edx
+	pushl %edx
+	leal -20(%ebp),%eax
+	leal 8(%eax),%edx
+	pushl %edx
+	leal -20(%ebp),%eax
+	leal 4(%eax),%edx
+	pushl %edx
+	pushl $1
+	call cpuid
+	addl $32,%esp
+	movl -4(%ebp),%eax
+	andl $8388608,%eax
+	testl %eax,%eax
+	je .L7
+	movl $1,%eax
+	jmp .L3
+	.p2align 4,,7
+.L7:
+	xorl %eax,%eax
+	jmp .L3
+	.p2align 4,,7
+.L3:
+	movl %ebp,%esp
+	popl %ebp
+	ret
+.Lfe2:
+	.size	 mpg123_check_x86simd,.Lfe2-mpg123_check_cpu
+	.ident	"GCC: (GNU) pgcc-2.95.3 20010315 (AthlonGCC-0.0.3ex4, experimental)"
diff -urN xmms-1.2.7.orig/Input/mpg123/configure.c xmms-1.2.7/Input/mpg123/configure.c
--- xmms-1.2.7.orig/Input/mpg123/configure.c	Tue Mar 20 23:39:40 2001
+++ xmms-1.2.7/Input/mpg123/configure.c	Wed Mar  6 00:55:41 2002
@@ -3,6 +3,10 @@
 #include "libxmms/dirbrowser.h"
 #include "libxmms/titlestring.h"
 
+#ifdef USE_SIMD
+static long outscale = 32768;
+#endif
+
 static GtkWidget *mpg123_configurewin = NULL;
 static GtkWidget *vbox, *notebook;
 static GtkWidget *decode_vbox, *decode_hbox1;
@@ -11,8 +15,14 @@
 static GtkWidget *decode_freq_frame, *decode_freq_vbox, *decode_freq_1to1,
          *decode_freq_1to2, *decode_freq_1to4;
 static GtkWidget *option_frame, *option_vbox, *detect_by_content;
-#ifdef USE_3DNOW
-static GtkWidget *decoder_frame, *decoder_vbox, *auto_select, *decoder_3dnow, *decoder_fpu;
+#ifdef USE_SIMD
+static GtkWidget *decoder_frame, *decoder_vbox, *auto_select, *decoder_3dnow, *decoder_mmx, *decoder_fpu;
+
+static void toggle_decoder(gint m);
+static void adjust_decoder_select(gint m);
+static void set_sensitive_decoders(void);
+static void auto_select_cb(GtkWidget * w, gpointer data);
+static void select_simd_cb(GtkWidget * w, gpointer data);
 #endif
 
 /* unused
@@ -32,15 +42,6 @@
 
 MPG123Config mpg123_cfg;
 
-#ifdef USE_3DNOW
-int support_3dnow(void)
-{
-	if((mpg123_getcpuflags() & 0x80800000) == 0x80800000)
-		return TRUE;
-	return FALSE;
-}
-#endif
-
 static void mpg123_configurewin_ok(GtkWidget * widget, gpointer data)
 {
 	ConfigFile *cfg;
@@ -68,12 +69,16 @@
    mpg123_cfg.downsample=3;
    mpg123_cfg.downsample_custom=(gint)GTK_ADJUSTMENT(decode_freq_custom_adj)->value;
  */
-#ifdef USE_3DNOW
+#ifdef USE_SIMD
 	if (GTK_TOGGLE_BUTTON(auto_select)->active)
-                mpg123_cfg.use_3dnow = 0;
+                mpg123_cfg.select_simd = MODE_AUTO;
         else if (GTK_TOGGLE_BUTTON(decoder_fpu)->active)
-                mpg123_cfg.use_3dnow = 2;
-        else mpg123_cfg.use_3dnow = 1;
+                mpg123_cfg.select_simd = MODE_FPU;
+        else if (GTK_TOGGLE_BUTTON(decoder_mmx)->active)
+                mpg123_cfg.select_simd = MODE_MMX;
+        else mpg123_cfg.select_simd = MODE_3DNOW;
+
+        mpg123_make_decode_tables(outscale); /* re-make for MMX/non-MMX incompatibility */
 #endif
 	mpg123_cfg.http_buffer_size = (gint) GTK_ADJUSTMENT(streaming_size_adj)->value;
 	mpg123_cfg.http_prebuffer = (gint) GTK_ADJUSTMENT(streaming_pre_adj)->value;
@@ -141,8 +146,8 @@
 	xmms_cfg_write_boolean(cfg, "MPG123", "disable_id3v2", mpg123_cfg.disable_id3v2);
 	xmms_cfg_write_string(cfg, "MPG123", "id3_format", mpg123_cfg.id3_format);
 	xmms_cfg_write_boolean(cfg, "MPG123", "detect_by_content", mpg123_cfg.detect_by_content);
-#ifdef USE_3DNOW
-	xmms_cfg_write_int(cfg, "MPG123", "use_3dnow", mpg123_cfg.use_3dnow);
+#ifdef USE_SIMD
+	xmms_cfg_write_int(cfg, "MPG123", "select_simd", mpg123_cfg.select_simd);
 #endif
 	xmms_cfg_write_file(cfg, filename);
 	xmms_cfg_free(cfg);
@@ -150,50 +155,83 @@
 	gtk_widget_destroy(mpg123_configurewin);
 }
 
-#ifdef USE_3DNOW
-static void auto_select_cb(GtkWidget * w, gpointer data)
+#ifdef USE_SIMD
+static void toggle_decoder(gint m)
 {
-	if (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(auto_select)) == TRUE) {
-	  gtk_widget_set_sensitive(decoder_fpu, FALSE);
-	  gtk_widget_set_sensitive(decoder_3dnow, FALSE);
-	  if (support_3dnow() == TRUE) 
+	  switch (m) {
+	   case MODE_3DNOW:
 		gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(decoder_3dnow), TRUE);
-	  else
+	        break;
+	   case MODE_MMX:
+		gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(decoder_mmx), TRUE);
+	        break;
+	   case MODE_FPU:
 		gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(decoder_fpu), TRUE);
-	} else {
-	    gtk_widget_set_sensitive(decoder_3dnow, TRUE);
-	    gtk_widget_set_sensitive(decoder_fpu, TRUE);
-	}
+	        break;
+	   default:
+	      switch (mpg123_cfg.stat_simd) {
+	       case CPU_HAS_3DNOW:
+		 gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(decoder_3dnow), TRUE);
+		 break;
+	       case CPU_HAS_SSE:
+	       case CPU_HAS_MMX:
+		 gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(decoder_mmx), TRUE);
+		 break;
+	       default:
+		 gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(decoder_fpu), TRUE);
+		 break;
+	      }
+	  }
+	  set_sensitive_decoders();
+}
+
+static void adjust_decoder_select(gint m)
+{
+   switch(m) {
+    case TRUE:
+      gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(auto_select), TRUE);
+      gtk_widget_set_sensitive(decoder_fpu, FALSE);
+      gtk_widget_set_sensitive(decoder_mmx, FALSE);
+      gtk_widget_set_sensitive(decoder_3dnow, FALSE);
+      toggle_decoder(MODE_AUTO);
+      break;
+    default:
+      gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(auto_select), FALSE);
+      gtk_widget_set_sensitive(decoder_3dnow, TRUE);
+      gtk_widget_set_sensitive(decoder_mmx, TRUE);
+      gtk_widget_set_sensitive(decoder_fpu, TRUE);
+      toggle_decoder(mpg123_cfg.select_simd);
+      break;
+   }
 }
 
-static void use_3dnow_cb(GtkWidget * w, gpointer data)
+static void set_sensitive_decoders(void)
 {
-	if (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(decoder_3dnow)) == TRUE) {
+  if ( (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(decoder_3dnow)) == TRUE) || (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(decoder_mmx)) == TRUE) ) {
 		mpg123_cfg.resolution = 16;
 		gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(decode_res_16), TRUE);
 		gtk_widget_set_sensitive(decode_res_8, FALSE);
 
-		mpg123_cfg.channels = 2;
-		gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(decode_ch_stereo), TRUE);
-		gtk_widget_set_sensitive(decode_ch_mono, FALSE);
-
-		mpg123_cfg.downsample = 0;
-		gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(decode_freq_1to1), TRUE);
-		gtk_widget_set_sensitive(decode_freq_1to2, FALSE);
-		gtk_widget_set_sensitive(decode_freq_1to4, FALSE);
+                mpg123_cfg.downsample = 0;
+                gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(decode_freq_1to1)
+						  , TRUE);
+                gtk_widget_set_sensitive(decode_freq_1to2, FALSE);
+                gtk_widget_set_sensitive(decode_freq_1to4, FALSE);
+        } else {
+		gtk_widget_set_sensitive(decode_res_8, TRUE);
+		gtk_widget_set_sensitive(decode_freq_1to2, TRUE);
+		gtk_widget_set_sensitive(decode_freq_1to4, TRUE);
 	}
 }
 
-static void use_fpu_cb(GtkWidget * w, gpointer data)
+static void auto_select_cb(GtkWidget * w, gpointer data)
 {
-	if (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(decoder_fpu)) == TRUE) {
-		gtk_widget_set_sensitive(decode_res_8, TRUE);
-
-		gtk_widget_set_sensitive(decode_ch_mono, TRUE);
+   adjust_decoder_select(gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(auto_select)));
+}
 
-		gtk_widget_set_sensitive(decode_freq_1to2, TRUE);
-		gtk_widget_set_sensitive(decode_freq_1to4, TRUE);
-	}
+static void select_simd_cb(GtkWidget * w, gpointer data)
+{
+  set_sensitive_decoders();
 }
 #endif
 
@@ -318,16 +356,6 @@
 
 	gtk_box_pack_start(GTK_BOX(decode_res_vbox), decode_res_8, FALSE, FALSE, 0);
 
-#ifdef USE_3DNOW
-	if (((support_3dnow() == TRUE) && (mpg123_cfg.use_3dnow !=2 )) ||
-		((support_3dnow() == FALSE) && (mpg123_cfg.use_3dnow == 1)))
-	{
-		mpg123_cfg.resolution = 16;
-		gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(decode_res_16), TRUE);
-		gtk_widget_set_sensitive(decode_res_8, FALSE);
-	}
-#endif
-
 	decode_ch_frame = gtk_frame_new(_("Channels:"));
 	gtk_box_pack_start(GTK_BOX(decode_hbox1), decode_ch_frame, TRUE, TRUE, 0);
 
@@ -347,16 +375,6 @@
 
 	gtk_box_pack_start(GTK_BOX(decode_ch_vbox), decode_ch_mono, FALSE, FALSE, 0);
 
-#ifdef USE_3DNOW
-	if (((support_3dnow() == TRUE) && (mpg123_cfg.use_3dnow !=2 )) ||
-		((support_3dnow() == FALSE) && (mpg123_cfg.use_3dnow == 1)))
-	{
-		mpg123_cfg.channels = 2;
-		gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(decode_ch_stereo), TRUE);
-		gtk_widget_set_sensitive(decode_ch_mono, FALSE);
-	}
-#endif
-
 	decode_freq_frame = gtk_frame_new(_("Down sample:"));
 	gtk_box_pack_start(GTK_BOX(decode_vbox), decode_freq_frame, FALSE, FALSE, 0);
 
@@ -379,16 +397,6 @@
 		gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(decode_freq_1to4), TRUE);
 
 	gtk_box_pack_start(GTK_BOX(decode_freq_vbox), decode_freq_1to4, FALSE, FALSE, 0);
-#ifdef USE_3DNOW
-	if (((support_3dnow() == TRUE) && (mpg123_cfg.use_3dnow !=2 )) ||
-		((support_3dnow() == FALSE) && (mpg123_cfg.use_3dnow == 1)))
-	{
-		mpg123_cfg.downsample = 0;
-		gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(decode_freq_1to1), TRUE);
-		gtk_widget_set_sensitive(decode_freq_1to2, FALSE);
-		gtk_widget_set_sensitive(decode_freq_1to4, FALSE);
-	}
-#endif
 	/*decode_freq_custom_hbox=gtk_hbox_new(FALSE,5);
 	   gtk_box_pack_start(GTK_BOX(decode_freq_vbox),decode_freq_custom_hbox,FALSE,FALSE,0);
 
@@ -406,7 +414,7 @@
 	   gtk_box_pack_start(GTK_BOX(decode_freq_custom_hbox),decode_freq_custom_label,FALSE,FALSE,0); */
 
 
-#ifdef USE_3DNOW
+#ifdef USE_SIMD
 	decoder_frame = gtk_frame_new(_("Decoder:"));
 	gtk_box_pack_start(GTK_BOX(decode_vbox), decoder_frame, FALSE, FALSE, 0);
 
@@ -415,27 +423,22 @@
 	gtk_container_add(GTK_CONTAINER(decoder_frame), decoder_vbox);
 
 	auto_select = gtk_check_button_new_with_label(_("Enable Automatic detection"));
-	if (mpg123_cfg.use_3dnow == 0)
-		gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(auto_select), TRUE);
 	gtk_box_pack_start(GTK_BOX(decoder_vbox), auto_select, FALSE, FALSE, 0);
 	gtk_signal_connect(GTK_OBJECT(auto_select), "clicked", GTK_SIGNAL_FUNC(auto_select_cb), NULL);
 
 	decoder_3dnow = gtk_radio_button_new_with_label(NULL, _("use 3DNow! optimized decoder"));
-	if (((support_3dnow() == TRUE) && mpg123_cfg.use_3dnow != 2) || (mpg123_cfg.use_3dnow == 1))
-		gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(decoder_3dnow), TRUE);
 	gtk_box_pack_start(GTK_BOX(decoder_vbox), decoder_3dnow, FALSE, FALSE, 0);
-	gtk_signal_connect(GTK_OBJECT(decoder_3dnow), "clicked", GTK_SIGNAL_FUNC(use_3dnow_cb), NULL);
-	if (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(auto_select)) == TRUE)
-		gtk_widget_set_sensitive(decoder_3dnow, FALSE);
+	gtk_signal_connect(GTK_OBJECT(decoder_3dnow), "clicked", GTK_SIGNAL_FUNC(select_simd_cb), NULL);
+
+	decoder_mmx = gtk_radio_button_new_with_label(gtk_radio_button_group(GTK_RADIO_BUTTON(decoder_3dnow)), _("use MMX optimized decoder"));
+	gtk_box_pack_start(GTK_BOX(decoder_vbox), decoder_mmx, FALSE, FALSE, 0);
+	gtk_signal_connect(GTK_OBJECT(decoder_mmx), "clicked", GTK_SIGNAL_FUNC(select_simd_cb), NULL);
 
 	decoder_fpu = gtk_radio_button_new_with_label(gtk_radio_button_group(GTK_RADIO_BUTTON(decoder_3dnow)), _("use FPU decoder"));
-	if (((support_3dnow() == FALSE) && mpg123_cfg.use_3dnow != 1) || (mpg123_cfg.use_3dnow == 2))
-		gtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(decoder_fpu), TRUE);
 	gtk_box_pack_start(GTK_BOX(decoder_vbox), decoder_fpu, FALSE, FALSE, 0);
-	gtk_signal_connect(GTK_OBJECT(decoder_fpu), "clicked", GTK_SIGNAL_FUNC(use_fpu_cb), NULL);
-	if (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(auto_select)) == TRUE)
-		gtk_widget_set_sensitive(decoder_fpu, FALSE);
+	gtk_signal_connect(GTK_OBJECT(decoder_fpu), "clicked", GTK_SIGNAL_FUNC(select_simd_cb), NULL);
 
+	adjust_decoder_select(mpg123_cfg.select_simd == MODE_AUTO);
 #endif
 	option_frame = gtk_frame_new(_("Options"));
 	gtk_box_pack_start(GTK_BOX(decode_vbox), option_frame, FALSE, FALSE, 0);
diff -urN xmms-1.2.7.orig/Input/mpg123/dct64_3dnow.s xmms-1.2.7/Input/mpg123/dct64_3dnow.s
--- xmms-1.2.7.orig/Input/mpg123/dct64_3dnow.s	Mon Oct  2 18:50:58 2000
+++ xmms-1.2.7/Input/mpg123/dct64_3dnow.s	Wed Mar  6 00:55:41 2002
@@ -9,7 +9,7 @@
 /// this program. Use it at your own risk.
 /// 
 /
-/ porting xmms-0.9.1 by Osamu kayasono <kayasono@mb.infoweb.ne.jp>
+/ porting xmms-0.9.1 by Osamu kayasono <jacobi@jcom.home.ne.jp>
 / - rename function name for xmms
 /
 
diff -urN xmms-1.2.7.orig/Input/mpg123/dct64_MMX.s xmms-1.2.7/Input/mpg123/dct64_MMX.s
--- xmms-1.2.7.orig/Input/mpg123/dct64_MMX.s	Thu Jan  1 09:00:00 1970
+++ xmms-1.2.7/Input/mpg123/dct64_MMX.s	Wed Mar  6 00:55:41 2002
@@ -0,0 +1,836 @@
+.data
+	.align 32
+costab:
+	.long 1056974725
+	.long 1057056395
+	.long 1057223771
+	.long 1057485416
+	.long 1057855544
+	.long 1058356026
+	.long 1059019886
+	.long 1059897405
+	.long 1061067246
+	.long 1062657950
+	.long 1064892987
+	.long 1066774581
+	.long 1069414683
+	.long 1073984175
+	.long 1079645762
+	.long 1092815430
+	.long 1057005197
+	.long 1057342072
+	.long 1058087743
+	.long 1059427869
+	.long 1061799040
+	.long 1065862217
+	.long 1071413542
+	.long 1084439708
+	.long 1057128951
+	.long 1058664893
+	.long 1063675095
+	.long 1076102863
+	.long 1057655764
+	.long 1067924853
+	.long 1060439283
+
+.text
+
+	.align 32
+.globl mpg123_dct64_mmx
+mpg123_dct64_mmx:
+
+	xorl %ecx,%ecx
+.globl dct64_MMX
+dct64_MMX:
+	pushl %ebx
+	pushl %esi
+	pushl %edi
+	subl $256,%esp
+	movl 280(%esp),%eax
+	flds     (%eax)
+	leal 128(%esp),%edx
+	fadds 124(%eax)
+	movl 272(%esp),%esi
+	fstps    (%edx)
+	movl 276(%esp),%edi
+	flds    4(%eax)
+	movl $costab,%ebx
+	fadds 120(%eax)
+	orl %ecx,%ecx
+	fstps   4(%edx)
+	flds     (%eax)
+	movl %esp,%ecx
+	fsubs 124(%eax)
+	fmuls    (%ebx)
+	fstps 124(%edx)
+	flds    4(%eax)
+	fsubs 120(%eax)
+	fmuls   4(%ebx)
+	fstps 120(%edx)
+	flds    8(%eax)
+	fadds 116(%eax)
+	fstps   8(%edx)
+	flds   12(%eax)
+	fadds 112(%eax)
+	fstps  12(%edx)
+	flds    8(%eax)
+	fsubs 116(%eax)
+	fmuls   8(%ebx)
+	fstps 116(%edx)
+	flds   12(%eax)
+	fsubs 112(%eax)
+	fmuls  12(%ebx)
+	fstps 112(%edx)
+	flds   16(%eax)
+	fadds 108(%eax)
+	fstps  16(%edx)
+	flds   20(%eax)
+	fadds 104(%eax)
+	fstps  20(%edx)
+	flds   16(%eax)
+	fsubs 108(%eax)
+	fmuls  16(%ebx)
+	fstps 108(%edx)
+	flds   20(%eax)
+	fsubs 104(%eax)
+	fmuls  20(%ebx)
+	fstps 104(%edx)
+	flds   24(%eax)
+	fadds 100(%eax)
+	fstps  24(%edx)
+	flds   28(%eax)
+	fadds  96(%eax)
+	fstps  28(%edx)
+	flds   24(%eax)
+	fsubs 100(%eax)
+	fmuls  24(%ebx)
+	fstps 100(%edx)
+	flds   28(%eax)
+	fsubs  96(%eax)
+	fmuls  28(%ebx)
+	fstps  96(%edx)
+	flds   32(%eax)
+	fadds  92(%eax)
+	fstps  32(%edx)
+	flds   36(%eax)
+	fadds  88(%eax)
+	fstps  36(%edx)
+	flds   32(%eax)
+	fsubs  92(%eax)
+	fmuls  32(%ebx)
+	fstps  92(%edx)
+	flds   36(%eax)
+	fsubs  88(%eax)
+	fmuls  36(%ebx)
+	fstps  88(%edx)
+	flds   40(%eax)
+	fadds  84(%eax)
+	fstps  40(%edx)
+	flds   44(%eax)
+	fadds  80(%eax)
+	fstps  44(%edx)
+	flds   40(%eax)
+	fsubs  84(%eax)
+	fmuls  40(%ebx)
+	fstps  84(%edx)
+	flds   44(%eax)
+	fsubs  80(%eax)
+	fmuls  44(%ebx)
+	fstps  80(%edx)
+	flds   48(%eax)
+	fadds  76(%eax)
+	fstps  48(%edx)
+	flds   52(%eax)
+	fadds  72(%eax)
+	fstps  52(%edx)
+	flds   48(%eax)
+	fsubs  76(%eax)
+	fmuls  48(%ebx)
+	fstps  76(%edx)
+	flds   52(%eax)
+	fsubs  72(%eax)
+	fmuls  52(%ebx)
+	fstps  72(%edx)
+	flds   56(%eax)
+	fadds  68(%eax)
+	fstps  56(%edx)
+	flds   60(%eax)
+	fadds  64(%eax)
+	fstps  60(%edx)
+	flds   56(%eax)
+	fsubs  68(%eax)
+	fmuls  56(%ebx)
+	fstps  68(%edx)
+	flds   60(%eax)
+	fsubs  64(%eax)
+	fmuls  60(%ebx)
+	fstps  64(%edx)
+	
+	flds     (%edx)
+	fadds  60(%edx)
+	fstps    (%ecx)
+	flds    4(%edx)
+	fadds  56(%edx)
+	fstps   4(%ecx)
+	flds     (%edx)
+	fsubs  60(%edx)
+	fmuls  64(%ebx)
+	fstps  60(%ecx)
+	flds    4(%edx)
+	fsubs  56(%edx)
+	fmuls  68(%ebx)
+	fstps  56(%ecx)
+	flds    8(%edx)
+	fadds  52(%edx)
+	fstps   8(%ecx)
+	flds   12(%edx)
+	fadds  48(%edx)
+	fstps  12(%ecx)
+	flds    8(%edx)
+	fsubs  52(%edx)
+	fmuls  72(%ebx)
+	fstps  52(%ecx)
+	flds   12(%edx)
+	fsubs  48(%edx)
+	fmuls  76(%ebx)
+	fstps  48(%ecx)
+	flds   16(%edx)
+	fadds  44(%edx)
+	fstps  16(%ecx)
+	flds   20(%edx)
+	fadds  40(%edx)
+	fstps  20(%ecx)
+	flds   16(%edx)
+	fsubs  44(%edx)
+	fmuls  80(%ebx)
+	fstps  44(%ecx)
+	flds   20(%edx)
+	fsubs  40(%edx)
+	fmuls  84(%ebx)
+	fstps  40(%ecx)
+	flds   24(%edx)
+	fadds  36(%edx)
+	fstps  24(%ecx)
+	flds   28(%edx)
+	fadds  32(%edx)
+	fstps  28(%ecx)
+	flds   24(%edx)
+	fsubs  36(%edx)
+	fmuls  88(%ebx)
+	fstps  36(%ecx)
+	flds   28(%edx)
+	fsubs  32(%edx)
+	fmuls  92(%ebx)
+	fstps  32(%ecx)
+	
+	flds   64(%edx)
+	fadds 124(%edx)
+	fstps  64(%ecx)
+	flds   68(%edx)
+	fadds 120(%edx)
+	fstps  68(%ecx)
+	flds  124(%edx)
+	fsubs  64(%edx)
+	fmuls  64(%ebx)
+	fstps 124(%ecx)
+	flds  120(%edx)
+	fsubs  68(%edx)
+	fmuls  68(%ebx)
+	fstps 120(%ecx)
+	flds   72(%edx)
+	fadds 116(%edx)
+	fstps  72(%ecx)
+	flds   76(%edx)
+	fadds 112(%edx)
+	fstps  76(%ecx)
+	flds  116(%edx)
+	fsubs  72(%edx)
+	fmuls  72(%ebx)
+	fstps 116(%ecx)
+	flds  112(%edx)
+	fsubs  76(%edx)
+	fmuls  76(%ebx)
+	fstps 112(%ecx)
+	flds   80(%edx)
+	fadds 108(%edx)
+	fstps  80(%ecx)
+	flds   84(%edx)
+	fadds 104(%edx)
+	fstps  84(%ecx)
+	flds  108(%edx)
+	fsubs  80(%edx)
+	fmuls  80(%ebx)
+	fstps 108(%ecx)
+	flds  104(%edx)
+	fsubs  84(%edx)
+	fmuls  84(%ebx)
+	fstps 104(%ecx)
+	flds   88(%edx)
+	fadds 100(%edx)
+	fstps  88(%ecx)
+	flds   92(%edx)
+	fadds  96(%edx)
+	fstps  92(%ecx)
+	flds  100(%edx)
+	fsubs  88(%edx)
+	fmuls  88(%ebx)
+	fstps 100(%ecx)
+	flds   96(%edx)
+	fsubs  92(%edx)
+	fmuls  92(%ebx)
+	fstps  96(%ecx)
+	
+	flds     (%ecx)
+	fadds  28(%ecx)
+	fstps    (%edx)
+	flds     (%ecx)
+	fsubs  28(%ecx)
+	fmuls  96(%ebx)
+	fstps  28(%edx)
+	flds    4(%ecx)
+	fadds  24(%ecx)
+	fstps   4(%edx)
+	flds    4(%ecx)
+	fsubs  24(%ecx)
+	fmuls 100(%ebx)
+	fstps  24(%edx)
+	flds    8(%ecx)
+	fadds  20(%ecx)
+	fstps   8(%edx)
+	flds    8(%ecx)
+	fsubs  20(%ecx)
+	fmuls 104(%ebx)
+	fstps  20(%edx)
+	flds   12(%ecx)
+	fadds  16(%ecx)
+	fstps  12(%edx)
+	flds   12(%ecx)
+	fsubs  16(%ecx)
+	fmuls 108(%ebx)
+	fstps  16(%edx)
+	flds   32(%ecx)
+	fadds  60(%ecx)
+	fstps  32(%edx)
+	flds   60(%ecx)
+	fsubs  32(%ecx)
+	fmuls  96(%ebx)
+	fstps  60(%edx)
+	flds   36(%ecx)
+	fadds  56(%ecx)
+	fstps  36(%edx)
+	flds   56(%ecx)
+	fsubs  36(%ecx)
+	fmuls 100(%ebx)
+	fstps  56(%edx)
+	flds   40(%ecx)
+	fadds  52(%ecx)
+	fstps  40(%edx)
+	flds   52(%ecx)
+	fsubs  40(%ecx)
+	fmuls 104(%ebx)
+	fstps  52(%edx)
+	flds   44(%ecx)
+	fadds  48(%ecx)
+	fstps  44(%edx)
+	flds   48(%ecx)
+	fsubs  44(%ecx)
+	fmuls 108(%ebx)
+	fstps  48(%edx)
+	flds   64(%ecx)
+	fadds  92(%ecx)
+	fstps  64(%edx)
+	flds   64(%ecx)
+	fsubs  92(%ecx)
+	fmuls  96(%ebx)
+	fstps  92(%edx)
+	flds   68(%ecx)
+	fadds  88(%ecx)
+	fstps  68(%edx)
+	flds   68(%ecx)
+	fsubs  88(%ecx)
+	fmuls 100(%ebx)
+	fstps  88(%edx)
+	flds   72(%ecx)
+	fadds  84(%ecx)
+	fstps  72(%edx)
+	flds   72(%ecx)
+	fsubs  84(%ecx)
+	fmuls 104(%ebx)
+	fstps  84(%edx)
+	flds   76(%ecx)
+	fadds  80(%ecx)
+	fstps  76(%edx)
+	flds   76(%ecx)
+	fsubs  80(%ecx)
+	fmuls 108(%ebx)
+	fstps  80(%edx)
+	flds   96(%ecx)
+	fadds 124(%ecx)
+	fstps  96(%edx)
+	flds  124(%ecx)
+	fsubs  96(%ecx)
+	fmuls  96(%ebx)
+	fstps 124(%edx)
+	flds  100(%ecx)
+	fadds 120(%ecx)
+	fstps 100(%edx)
+	flds  120(%ecx)
+	fsubs 100(%ecx)
+	fmuls 100(%ebx)
+	fstps 120(%edx)
+	flds  104(%ecx)
+	fadds 116(%ecx)
+	fstps 104(%edx)
+	flds  116(%ecx)
+	fsubs 104(%ecx)
+	fmuls 104(%ebx)
+	fstps 116(%edx)
+	flds  108(%ecx)
+	fadds 112(%ecx)
+	fstps 108(%edx)
+	flds  112(%ecx)
+	fsubs 108(%ecx)
+	fmuls 108(%ebx)
+	fstps 112(%edx)
+	flds     (%edx)
+	fadds  12(%edx)
+	fstps    (%ecx)
+	flds     (%edx)
+	fsubs  12(%edx)
+	fmuls 112(%ebx)
+	fstps  12(%ecx)
+	flds    4(%edx)
+	fadds   8(%edx)
+	fstps   4(%ecx)
+	flds    4(%edx)
+	fsubs   8(%edx)
+	fmuls 116(%ebx)
+	fstps   8(%ecx)
+	flds   16(%edx)
+	fadds  28(%edx)
+	fstps  16(%ecx)
+	flds   28(%edx)
+	fsubs  16(%edx)
+	fmuls 112(%ebx)
+	fstps  28(%ecx)
+	flds   20(%edx)
+	fadds  24(%edx)
+	fstps  20(%ecx)
+	flds   24(%edx)
+	fsubs  20(%edx)
+	fmuls 116(%ebx)
+	fstps  24(%ecx)
+	flds   32(%edx)
+	fadds  44(%edx)
+	fstps  32(%ecx)
+	flds   32(%edx)
+	fsubs  44(%edx)
+	fmuls 112(%ebx)
+	fstps  44(%ecx)
+	flds   36(%edx)
+	fadds  40(%edx)
+	fstps  36(%ecx)
+	flds   36(%edx)
+	fsubs  40(%edx)
+	fmuls 116(%ebx)
+	fstps  40(%ecx)
+	flds   48(%edx)
+	fadds  60(%edx)
+	fstps  48(%ecx)
+	flds   60(%edx)
+	fsubs  48(%edx)
+	fmuls 112(%ebx)
+	fstps  60(%ecx)
+	flds   52(%edx)
+	fadds  56(%edx)
+	fstps  52(%ecx)
+	flds   56(%edx)
+	fsubs  52(%edx)
+	fmuls 116(%ebx)
+	fstps  56(%ecx)
+	flds   64(%edx)
+	fadds  76(%edx)
+	fstps  64(%ecx)
+	flds   64(%edx)
+	fsubs  76(%edx)
+	fmuls 112(%ebx)
+	fstps  76(%ecx)
+	flds   68(%edx)
+	fadds  72(%edx)
+	fstps  68(%ecx)
+	flds   68(%edx)
+	fsubs  72(%edx)
+	fmuls 116(%ebx)
+	fstps  72(%ecx)
+	flds   80(%edx)
+	fadds  92(%edx)
+	fstps  80(%ecx)
+	flds   92(%edx)
+	fsubs  80(%edx)
+	fmuls 112(%ebx)
+	fstps  92(%ecx)
+	flds   84(%edx)
+	fadds  88(%edx)
+	fstps  84(%ecx)
+	flds   88(%edx)
+	fsubs  84(%edx)
+	fmuls 116(%ebx)
+	fstps  88(%ecx)
+	flds   96(%edx)
+	fadds 108(%edx)
+	fstps  96(%ecx)
+	flds   96(%edx)
+	fsubs 108(%edx)
+	fmuls 112(%ebx)
+	fstps 108(%ecx)
+	flds  100(%edx)
+	fadds 104(%edx)
+	fstps 100(%ecx)
+	flds  100(%edx)
+	fsubs 104(%edx)
+	fmuls 116(%ebx)
+	fstps 104(%ecx)
+	flds  112(%edx)
+	fadds 124(%edx)
+	fstps 112(%ecx)
+	flds  124(%edx)
+	fsubs 112(%edx)
+	fmuls 112(%ebx)
+	fstps 124(%ecx)
+	flds  116(%edx)
+	fadds 120(%edx)
+	fstps 116(%ecx)
+	flds  120(%edx)
+	fsubs 116(%edx)
+	fmuls 116(%ebx)
+	fstps 120(%ecx)
+	
+	flds   32(%ecx)
+	fadds  36(%ecx)
+	fstps  32(%edx)
+	flds   32(%ecx)
+	fsubs  36(%ecx)
+	fmuls 120(%ebx)
+	fstps  36(%edx)
+	flds   44(%ecx)
+	fsubs  40(%ecx)
+	fmuls 120(%ebx)
+	fsts   44(%edx)
+	fadds  40(%ecx)
+	fadds  44(%ecx)
+	fstps  40(%edx)
+	flds   48(%ecx)
+	fsubs  52(%ecx)
+	fmuls 120(%ebx)
+	flds   60(%ecx)
+	fsubs  56(%ecx)
+	fmuls 120(%ebx)
+	fld      %st(0)
+	fadds  56(%ecx)
+	fadds  60(%ecx)
+	fld      %st(0)
+	fadds  48(%ecx)
+	fadds  52(%ecx)
+	fstps  48(%edx)
+	fadd     %st(2)
+	fstps  56(%edx)
+	fsts   60(%edx)
+	faddp    %st(1)
+	fstps  52(%edx)
+	flds   64(%ecx)
+	fadds  68(%ecx)
+	fstps  64(%edx)
+	flds   64(%ecx)
+	fsubs  68(%ecx)
+	fmuls 120(%ebx)
+	fstps  68(%edx)
+	flds   76(%ecx)
+	fsubs  72(%ecx)
+	fmuls 120(%ebx)
+	fsts   76(%edx)
+	fadds  72(%ecx)
+	fadds  76(%ecx)
+	fstps  72(%edx)
+	flds   92(%ecx)
+	fsubs  88(%ecx)
+	fmuls 120(%ebx)
+	fsts   92(%edx)
+	fadds  92(%ecx)
+	fadds  88(%ecx)
+	fld      %st(0)
+	fadds  80(%ecx)
+	fadds  84(%ecx)
+	fstps  80(%edx)
+	flds   80(%ecx)
+	fsubs  84(%ecx)
+	fmuls 120(%ebx)
+	fadd  %st(0), %st(1)
+	fadds 92(%edx)
+	fstps 84(%edx)
+	fstps 88(%edx)
+	flds   96(%ecx)
+	fadds 100(%ecx)
+	fstps  96(%edx)
+	flds   96(%ecx)
+	fsubs 100(%ecx)
+	fmuls 120(%ebx)
+	fstps 100(%edx)
+	flds  108(%ecx)
+	fsubs 104(%ecx)
+	fmuls 120(%ebx)
+	fsts  108(%edx)
+	fadds 104(%ecx)
+	fadds 108(%ecx)
+	fstps 104(%edx)
+	flds  124(%ecx)
+	fsubs 120(%ecx)
+	fmuls 120(%ebx)
+	fsts  124(%edx)
+	fadds 120(%ecx)
+	fadds 124(%ecx)
+	fld      %st(0)
+	fadds 112(%ecx)
+	fadds 116(%ecx)
+	fstps 112(%edx)
+	flds  112(%ecx)
+	fsubs 116(%ecx)
+	fmuls 120(%ebx)
+	fadd  %st(0),%st(1)
+	fadds 124(%edx)
+	fstps 116(%edx)
+	fstps 120(%edx)
+	jnz .L01
+	
+	flds      (%ecx)
+	fadds    4(%ecx)
+	fstps 1024(%esi)
+	flds      (%ecx)
+	fsubs    4(%ecx)
+	fmuls  120(%ebx)
+	fsts      (%esi)
+	fstps     (%edi)
+	flds   12(%ecx)
+	fsubs   8(%ecx)
+	fmuls 120(%ebx)
+	fsts  512(%edi)
+	fadds  12(%ecx)
+	fadds   8(%ecx)
+	fstps 512(%esi)
+	flds   16(%ecx)
+	fsubs  20(%ecx)
+	fmuls 120(%ebx)
+	flds   28(%ecx)
+	fsubs  24(%ecx)
+	fmuls 120(%ebx)
+	fsts  768(%edi)
+	fld      %st(0)
+	fadds  24(%ecx)
+	fadds  28(%ecx)
+	fld      %st(0)
+	fadds  16(%ecx)
+	fadds  20(%ecx)
+	fstps 768(%esi)
+	fadd     %st(2)
+	fstps 256(%esi)
+	faddp    %st(1)
+	fstps 256(%edi)
+	
+	flds   32(%edx)
+	fadds  48(%edx)
+	fstps 896(%esi)
+	flds   48(%edx)
+	fadds  40(%edx)
+	fstps 640(%esi)
+	flds   40(%edx)
+	fadds  56(%edx)
+	fstps 384(%esi)
+	flds   56(%edx)
+	fadds  36(%edx)
+	fstps 128(%esi)
+	flds   36(%edx)
+	fadds  52(%edx)
+	fstps 128(%edi)
+	flds   52(%edx)
+	fadds  44(%edx)
+	fstps 384(%edi)
+	flds   60(%edx)
+	fsts  896(%edi)
+	fadds  44(%edx)
+	fstps 640(%edi)
+	flds   96(%edx)
+	fadds 112(%edx)
+	fld      %st(0)
+	fadds  64(%edx)
+	fstps 960(%esi)
+	fadds  80(%edx)
+	fstps 832(%esi)
+	flds  112(%edx)
+	fadds 104(%edx)
+	fld      %st(0)
+	fadds  80(%edx)
+	fstps 704(%esi)
+	fadds  72(%edx)
+	fstps 576(%esi)
+	flds  104(%edx)
+	fadds 120(%edx)
+	fld      %st(0)
+	fadds  72(%edx)
+	fstps 448(%esi)
+	fadds  88(%edx)
+	fstps 320(%esi)
+	flds  120(%edx)
+	fadds 100(%edx)
+	fld      %st(0)
+	fadds  88(%edx)
+	fstps 192(%esi)
+	fadds  68(%edx)
+	fstps  64(%esi)
+	flds  100(%edx)
+	fadds 116(%edx)
+	fld      %st(0)
+	fadds  68(%edx)
+	fstps  64(%edi)
+	fadds  84(%edx)
+	fstps 192(%edi)
+	flds  116(%edx)
+	fadds 108(%edx)
+	fld      %st(0)
+	fadds  84(%edx)
+	fstps 320(%edi)
+	fadds  76(%edx)
+	fstps 448(%edi)
+	flds  108(%edx)
+	fadds 124(%edx)
+	fld      %st(0)
+	fadds  76(%edx)
+	fstps 576(%edi)
+	fadds  92(%edx)
+	fstps 704(%edi)
+	flds  124(%edx)
+	fsts  960(%edi)
+	fadds  92(%edx)
+	fstps 832(%edi)
+	addl $256,%esp
+	popl %edi
+	popl %esi
+	popl %ebx
+	ret
+.L01:	
+	flds      (%ecx)
+	fadds    4(%ecx)
+	fistp  512(%esi)
+	flds      (%ecx)
+	fsubs    4(%ecx)
+	fmuls  120(%ebx)
+
+	fistp     (%esi)
+
+	flds    12(%ecx)
+	fsubs    8(%ecx)
+	fmuls  120(%ebx)
+	fist   256(%edi)
+	fadds   12(%ecx)
+	fadds    8(%ecx)
+	fistp  256(%esi)
+	flds   16(%ecx)
+	fsubs  20(%ecx)
+	fmuls 120(%ebx)
+	flds   28(%ecx)
+	fsubs  24(%ecx)
+	fmuls 120(%ebx)
+	fist  384(%edi)
+	fld      %st(0)
+	fadds  24(%ecx)
+	fadds  28(%ecx)
+	fld      %st(0)
+	fadds  16(%ecx)
+	fadds  20(%ecx)
+	fistp  384(%esi)
+	fadd     %st(2)
+	fistp  128(%esi)
+	faddp    %st(1)
+	fistp  128(%edi)
+	
+	flds    32(%edx)
+	fadds   48(%edx)
+	fistp  448(%esi)
+	flds   48(%edx)
+	fadds  40(%edx)
+	fistp 320(%esi)
+	flds   40(%edx)
+	fadds  56(%edx)
+	fistp 192(%esi)
+	flds   56(%edx)
+	fadds  36(%edx)
+	fistp  64(%esi)
+	flds   36(%edx)
+	fadds  52(%edx)
+	fistp  64(%edi)
+	flds   52(%edx)
+	fadds  44(%edx)
+	fistp 192(%edi)
+	flds   60(%edx)
+	fist   448(%edi)
+	fadds  44(%edx)
+	fistp 320(%edi)
+	flds   96(%edx)
+	fadds 112(%edx)
+	fld      %st(0)
+	fadds  64(%edx)
+	fistp 480(%esi)
+	fadds  80(%edx)
+	fistp 416(%esi)
+	flds  112(%edx)
+	fadds 104(%edx)
+	fld      %st(0)
+	fadds  80(%edx)
+	fistp 352(%esi)
+	fadds  72(%edx)
+	fistp 288(%esi)
+	flds  104(%edx)
+	fadds 120(%edx)
+	fld      %st(0)
+	fadds  72(%edx)
+	fistp 224(%esi)
+	fadds  88(%edx)
+	fistp 160(%esi)
+	flds  120(%edx)
+	fadds 100(%edx)
+	fld      %st(0)
+	fadds  88(%edx)
+	fistp  96(%esi)
+	fadds  68(%edx)
+	fistp  32(%esi)
+	flds  100(%edx)
+	fadds 116(%edx)
+	fld      %st(0)
+	fadds  68(%edx)
+	fistp  32(%edi)
+	fadds  84(%edx)
+	fistp  96(%edi)
+	flds  116(%edx)
+	fadds 108(%edx)
+	fld      %st(0)
+	fadds  84(%edx)
+	fistp 160(%edi)
+	fadds  76(%edx)
+	fistp 224(%edi)
+	flds  108(%edx)
+	fadds 124(%edx)
+	fld      %st(0)
+	fadds  76(%edx)
+	fistp 288(%edi)
+	fadds  92(%edx)
+	fistp 352(%edi)
+	flds  124(%edx)
+	fist  480(%edi)
+	fadds  92(%edx)
+	fistp 416(%edi)
+	movsw
+	addl $256,%esp
+	popl %edi
+	popl %esi
+	popl %ebx
+	ret
+	
+
diff -urN xmms-1.2.7.orig/Input/mpg123/decode_2to1.c xmms-1.2.7/Input/mpg123/decode_2to1.c
--- xmms-1.2.7.orig/Input/mpg123/decode_2to1.c	Thu Jan 13 07:59:03 2000
+++ xmms-1.2.7/Input/mpg123/decode_2to1.c	Wed Mar  6 00:55:41 2002
@@ -19,14 +19,22 @@
   else if( (sum) < -32768.0) { *(samples) = -0x8000; (clip)++; } \
   else { *(samples) = sum; }
 
+#ifdef USE_SIMD
+int mpg123_synth_2to1_8bit(real * bandPtr, int channel, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_2to1_8bit(real * bandPtr, int channel, unsigned char *samples, int *pnt)
+#endif
 {
 	short samples_tmp[32];
 	short *tmp1 = samples_tmp + channel;
 	int i, ret;
 	int pnt1 = 0;
 
+#ifdef USE_SIMD
+	ret = mpg123_synth_2to1(bandPtr, channel, (unsigned char *) samples_tmp, &pnt1, fr);
+#else
 	ret = mpg123_synth_2to1(bandPtr, channel, (unsigned char *) samples_tmp, &pnt1);
+#endif
 	samples += channel + *pnt;
 
 	for (i = 0; i < 16; i++)
@@ -40,14 +48,22 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_2to1_8bit_mono(real * bandPtr, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_2to1_8bit_mono(real * bandPtr, unsigned char *samples, int *pnt)
+#endif
 {
 	short samples_tmp[32];
 	short *tmp1 = samples_tmp;
 	int i, ret;
 	int pnt1 = 0;
 
+#ifdef USE_SIMD
+	ret = mpg123_synth_2to1(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1, fr);
+#else
 	ret = mpg123_synth_2to1(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1);
+#endif
 	samples += *pnt;
 
 	for (i = 0; i < 16; i++)
@@ -60,14 +76,22 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_2to1_8bit_mono2stereo(real * bandPtr, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_2to1_8bit_mono2stereo(real * bandPtr, unsigned char *samples, int *pnt)
+#endif
 {
 	short samples_tmp[32];
 	short *tmp1 = samples_tmp;
 	int i, ret;
 	int pnt1 = 0;
 
+#ifdef USE_SIMD
+	ret = mpg123_synth_2to1(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1, fr);
+#else
 	ret = mpg123_synth_2to1(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1);
+#endif
 	samples += *pnt;
 
 	for (i = 0; i < 16; i++)
@@ -81,14 +105,22 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_2to1_mono(real * bandPtr, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_2to1_mono(real * bandPtr, unsigned char *samples, int *pnt)
+#endif
 {
 	short samples_tmp[32];
 	short *tmp1 = samples_tmp;
 	int i, ret;
 	int pnt1 = 0;
 
+#ifdef USE_SIMD
+	ret = mpg123_synth_2to1(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1, fr);
+#else
 	ret = mpg123_synth_2to1(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1);
+#endif
 	samples += *pnt;
 
 	for (i = 0; i < 16; i++)
@@ -102,11 +134,19 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_2to1_mono2stereo(real * bandPtr, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_2to1_mono2stereo(real * bandPtr, unsigned char *samples, int *pnt)
+#endif
 {
 	int i, ret;
 
+#ifdef USE_SIMD
+	ret = mpg123_synth_2to1(bandPtr, 0, samples, pnt, fr);
+#else
 	ret = mpg123_synth_2to1(bandPtr, 0, samples, pnt);
+#endif
 	samples = samples + *pnt - 64;
 
 	for (i = 0; i < 16; i++)
@@ -118,7 +158,11 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_2to1(real * bandPtr, int channel, unsigned char *out, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_2to1(real * bandPtr, int channel, unsigned char *out, int *pnt)
+#endif
 {
 	static real buffs[2][2][0x110];
 	static const int step = 2;
diff -urN xmms-1.2.7.orig/Input/mpg123/decode_3dnow.s xmms-1.2.7/Input/mpg123/decode_3dnow.s
--- xmms-1.2.7.orig/Input/mpg123/decode_3dnow.s	Mon Oct  2 18:50:58 2000
+++ xmms-1.2.7/Input/mpg123/decode_3dnow.s	Wed Mar  6 00:55:41 2002
@@ -15,7 +15,7 @@
 / by KIMURA Takuhiro <kim@hannah.ipc.miyakyo-u.ac.jp> - until 31.Mar.1999
 /                    <kim@comtec.co.jp>               - after  1.Apr.1999
 /
-/ porting xmms-0.9.1 by Osamu kayasono <kayasono@mb.infoweb.ne.jp>
+/ porting xmms-0.9.1 by Osamu kayasono <jacobi@jcom.home.ne.jp>
 / - rename function name for xmms
 / - disable equalizer for mpg123
 
diff -urN xmms-1.2.7.orig/Input/mpg123/decode_4to1.c xmms-1.2.7/Input/mpg123/decode_4to1.c
--- xmms-1.2.7.orig/Input/mpg123/decode_4to1.c	Thu Jan 13 07:59:03 2000
+++ xmms-1.2.7/Input/mpg123/decode_4to1.c	Wed Mar  6 00:55:41 2002
@@ -20,14 +20,22 @@
   else if( (sum) < -32768.0) { *(samples) = -0x8000; (clip)++; } \
   else { *(samples) = sum; }
 
+#ifdef USE_SIMD
+int mpg123_synth_4to1_8bit(real * bandPtr, int channel, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_4to1_8bit(real * bandPtr, int channel, unsigned char *samples, int *pnt)
+#endif
 {
 	short samples_tmp[16];
 	short *tmp1 = samples_tmp + channel;
 	int i, ret;
 	int pnt1 = 0;
 
+#ifdef USE_SIMD
+	ret = mpg123_synth_4to1(bandPtr, channel, (unsigned char *) samples_tmp, &pnt1, fr);
+#else
 	ret = mpg123_synth_4to1(bandPtr, channel, (unsigned char *) samples_tmp, &pnt1);
+#endif
 	samples += channel + *pnt;
 
 	for (i = 0; i < 8; i++)
@@ -41,14 +49,22 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_4to1_8bit_mono(real * bandPtr, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_4to1_8bit_mono(real * bandPtr, unsigned char *samples, int *pnt)
+#endif
 {
 	short samples_tmp[16];
 	short *tmp1 = samples_tmp;
 	int i, ret;
 	int pnt1 = 0;
 
+#ifdef USE_SIMD
+	ret = mpg123_synth_4to1(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1, fr);
+#else
 	ret = mpg123_synth_4to1(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1);
+#endif
 	samples += *pnt;
 
 	for (i = 0; i < 8; i++)
@@ -61,14 +77,22 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_4to1_8bit_mono2stereo(real * bandPtr, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_4to1_8bit_mono2stereo(real * bandPtr, unsigned char *samples, int *pnt)
+#endif
 {
 	short samples_tmp[16];
 	short *tmp1 = samples_tmp;
 	int i, ret;
 	int pnt1 = 0;
 
+#ifdef USE_SIMD
+	ret = mpg123_synth_4to1(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1, fr);
+#else
 	ret = mpg123_synth_4to1(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1);
+#endif
 	samples += *pnt;
 
 	for (i = 0; i < 8; i++)
@@ -82,14 +106,22 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_4to1_mono(real * bandPtr, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_4to1_mono(real * bandPtr, unsigned char *samples, int *pnt)
+#endif
 {
 	short samples_tmp[16];
 	short *tmp1 = samples_tmp;
 	int i, ret;
 	int pnt1 = 0;
 
+#ifdef USE_SIMD
+	ret = mpg123_synth_4to1(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1, fr);
+#else
 	ret = mpg123_synth_4to1(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1);
+#endif
 	samples += *pnt;
 
 	for (i = 0; i < 8; i++)
@@ -103,11 +135,19 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_4to1_mono2stereo(real * bandPtr, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_4to1_mono2stereo(real * bandPtr, unsigned char *samples, int *pnt)
+#endif
 {
 	int i, ret;
 
+#ifdef USE_SIMD
+	ret = mpg123_synth_4to1(bandPtr, 0, samples, pnt, fr);
+#else
 	ret = mpg123_synth_4to1(bandPtr, 0, samples, pnt);
+#endif
 	samples = samples + *pnt - 32;
 
 	for (i = 0; i < 8; i++)
@@ -119,7 +159,11 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_4to1(real * bandPtr, int channel, unsigned char *out, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_4to1(real * bandPtr, int channel, unsigned char *out, int *pnt)
+#endif
 {
 	static real buffs[2][2][0x110];
 	static const int step = 2;
diff -urN xmms-1.2.7.orig/Input/mpg123/decode_MMX.s xmms-1.2.7/Input/mpg123/decode_MMX.s
--- xmms-1.2.7.orig/Input/mpg123/decode_MMX.s	Thu Jan  1 09:00:00 1970
+++ xmms-1.2.7/Input/mpg123/decode_MMX.s	Wed Mar  6 00:55:41 2002
@@ -0,0 +1,108 @@
+# this code comes under GPL
+
+.text
+
+.globl mpg123_synth_MMX
+
+mpg123_synth_MMX:
+        pushl %ebp
+        pushl %edi
+        pushl %esi
+        pushl %ebx
+        movl 24(%esp),%ecx              
+        movl 28(%esp),%edi              
+        movl $15,%ebx
+        movl 36(%esp),%edx              
+        leal (%edi,%ecx,2),%edi
+	decl %ecx
+        movl 32(%esp),%esi              
+        movl (%edx),%eax                
+        jecxz .L1
+        decl %eax
+        andl %ebx,%eax                  
+        leal 1088(%esi),%esi                            
+        movl %eax,(%edx)                
+.L1:
+        leal (%esi,%eax,2),%edx         
+        movl %eax,%ebp                  
+        incl %eax                       
+        pushl 20(%esp)                  
+        andl %ebx,%eax                  
+        leal 544(%esi,%eax,2),%ecx      
+        incl %ebx                       
+	testl $1, %eax
+	jnz .L2                       
+        xchgl %edx,%ecx
+	incl %ebp
+        leal 544(%esi),%esi           
+.L2: 
+        pushl %edx
+        pushl %ecx
+        call dct64_MMX
+        addl $12,%esp
+	leal 1(%ebx), %ecx
+        subl %ebp,%ebx                
+
+	leal mpg123_decwins(%ebx,%ebx,1), %edx
+.L3: 
+        movq  (%edx),%mm0
+        pmaddwd (%esi),%mm0
+        movq  8(%edx),%mm1
+        pmaddwd 8(%esi),%mm1
+        movq  16(%edx),%mm2
+        pmaddwd 16(%esi),%mm2
+        movq  24(%edx),%mm3
+        pmaddwd 24(%esi),%mm3
+        paddd %mm1,%mm0
+        paddd %mm2,%mm0
+        paddd %mm3,%mm0
+        movq  %mm0,%mm1
+        psrlq $32,%mm1
+        paddd %mm1,%mm0
+        psrad $13,%mm0
+        packssdw %mm0,%mm0
+        movd %mm0,%eax
+	movw %ax, (%edi)
+
+        leal 32(%esi),%esi
+        leal 64(%edx),%edx
+        leal 4(%edi),%edi                
+        loop .L3
+
+
+        subl $64,%esi                    
+        movl $15,%ecx
+.L4: 
+        movq  (%edx),%mm0
+        pmaddwd (%esi),%mm0
+        movq  8(%edx),%mm1
+        pmaddwd 8(%esi),%mm1
+        movq  16(%edx),%mm2
+        pmaddwd 16(%esi),%mm2
+        movq  24(%edx),%mm3
+        pmaddwd 24(%esi),%mm3
+        paddd %mm1,%mm0
+        paddd %mm2,%mm0
+        paddd %mm3,%mm0
+        movq  %mm0,%mm1
+        psrlq $32,%mm1
+        paddd %mm0,%mm1
+        psrad $13,%mm1
+        packssdw %mm1,%mm1
+        psubd %mm0,%mm0
+        psubsw %mm1,%mm0
+        movd %mm0,%eax
+	movw %ax,(%edi)
+
+        subl $32,%esi
+        addl $64,%edx
+        leal 4(%edi),%edi                
+        loop .L4
+	emms
+        popl %ebx
+        popl %esi
+        popl %edi
+        popl %ebp
+        ret
+
+
diff -urN xmms-1.2.7.orig/Input/mpg123/decode_i386.c xmms-1.2.7/Input/mpg123/decode_i386.c
--- xmms-1.2.7.orig/Input/mpg123/decode_i386.c	Tue Oct  3 00:28:41 2000
+++ xmms-1.2.7/Input/mpg123/decode_i386.c	Wed Mar  6 00:55:41 2002
@@ -17,6 +17,10 @@
 
 #include "mpg123.h"
 
+#ifdef USE_SIMD
+int mpg123_synth_MMX(real *, int, short *, short *, int *);
+#endif
+
 #if 0
  /* old WRITE_SAMPLE */
 #define WRITE_SAMPLE(samples,sum,clip) \
@@ -35,14 +39,22 @@
 }
 #endif
 
+#ifdef USE_SIMD
+int mpg123_synth_1to1_8bit(real * bandPtr, int channel, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_1to1_8bit(real * bandPtr, int channel, unsigned char *samples, int *pnt)
+#endif
 {
 	short samples_tmp[64];
 	short *tmp1 = samples_tmp + channel;
 	int i, ret;
 	int pnt1 = 0;
 
+#ifdef USE_SIMD
+	ret = (fr->synth1to1) (bandPtr, channel, (unsigned char *) samples_tmp, &pnt1, fr);
+#else
 	ret = mpg123_synth_1to1(bandPtr, channel, (unsigned char *) samples_tmp, &pnt1);
+#endif
 	samples += channel + *pnt;
 
 	for (i = 0; i < 32; i++)
@@ -56,14 +68,22 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_1to1_8bit_mono(real * bandPtr, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_1to1_8bit_mono(real * bandPtr, unsigned char *samples, int *pnt)
+#endif
 {
 	short samples_tmp[64];
 	short *tmp1 = samples_tmp;
 	int i, ret;
 	int pnt1 = 0;
 
+#ifdef USE_SIMD
+	ret = (fr->synth1to1)(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1, fr);
+#else
 	ret = mpg123_synth_1to1(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1);
+#endif
 	samples += *pnt;
 
 	for (i = 0; i < 32; i++)
@@ -76,14 +96,22 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_1to1_8bit_mono2stereo(real * bandPtr, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_1to1_8bit_mono2stereo(real * bandPtr, unsigned char *samples, int *pnt)
+#endif
 {
 	short samples_tmp[64];
 	short *tmp1 = samples_tmp;
 	int i, ret;
 	int pnt1 = 0;
 
+#ifdef USE_SIMD
+	ret = (fr->synth1to1)(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1, fr);
+#else
 	ret = mpg123_synth_1to1(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1);
+#endif
 	samples += *pnt;
 
 	for (i = 0; i < 32; i++)
@@ -97,14 +125,22 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_1to1_mono(real * bandPtr, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_1to1_mono(real * bandPtr, unsigned char *samples, int *pnt)
+#endif
 {
 	short samples_tmp[64];
 	short *tmp1 = samples_tmp;
 	int i, ret;
 	int pnt1 = 0;
 
+#ifdef USE_SIMD
+	ret = (fr->synth1to1)(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1, fr);
+#else
 	ret = mpg123_synth_1to1(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1);
+#endif
 	samples += *pnt;
 
 	for (i = 0; i < 32; i++)
@@ -118,11 +154,19 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_1to1_mono2stereo(real * bandPtr, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_1to1_mono2stereo(real * bandPtr, unsigned char *samples, int *pnt)
+#endif
 {
 	int i, ret;
 
+#ifdef USE_SIMD
+	ret = (fr->synth1to1)(bandPtr, 0, samples, pnt, fr);
+#else
 	ret = mpg123_synth_1to1(bandPtr, 0, samples, pnt);
+#endif
 	samples = samples + *pnt - 128;
 
 	for (i = 0; i < 32; i++)
@@ -134,7 +178,11 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_1to1(real * bandPtr, int channel, unsigned char *out, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_1to1(real * bandPtr, int channel, unsigned char *out, int *pnt)
+#endif
 {
 #if 0
 	static real buffs[2][2][0x110];
@@ -255,3 +303,16 @@
 	}
 #endif
 }
+
+#ifdef USE_SIMD
+int mpg123_synth_1to1_mmx(real * bandPtr, int channel, unsigned char *out, int *pnt, struct frame *fr)
+{
+	static short buffs[2][2][0x110];
+	static int bo = 1;
+	short *samples = (short *) (out + *pnt);
+
+	mpg123_synth_MMX(bandPtr, channel, samples, (short *) buffs, &bo);
+	*pnt += 128;
+	return 0;
+}
+#endif
diff -urN xmms-1.2.7.orig/Input/mpg123/decode_ntom.c xmms-1.2.7/Input/mpg123/decode_ntom.c
--- xmms-1.2.7.orig/Input/mpg123/decode_ntom.c	Thu Jan 13 07:59:03 2000
+++ xmms-1.2.7/Input/mpg123/decode_ntom.c	Wed Mar  6 00:55:41 2002
@@ -47,14 +47,22 @@
 	ntom_val[0] = ntom_val[1] = NTOM_MUL >> 1;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_ntom_8bit(real * bandPtr, int channel, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_ntom_8bit(real * bandPtr, int channel, unsigned char *samples, int *pnt)
+#endif
 {
 	short samples_tmp[8 * 64];
 	short *tmp1 = samples_tmp + channel;
 	int i, ret;
 	int pnt1 = 0;
 
+#ifdef USE_SIMD
+	ret = mpg123_synth_ntom(bandPtr, channel, (unsigned char *) samples_tmp, &pnt1, fr);
+#else
 	ret = mpg123_synth_ntom(bandPtr, channel, (unsigned char *) samples_tmp, &pnt1);
+#endif
 	samples += channel + *pnt;
 
 	for (i = 0; i < (pnt1 >> 2); i++)
@@ -68,14 +76,22 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_ntom_8bit_mono(real * bandPtr, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_ntom_8bit_mono(real * bandPtr, unsigned char *samples, int *pnt)
+#endif
 {
 	short samples_tmp[8 * 64];
 	short *tmp1 = samples_tmp;
 	int i, ret;
 	int pnt1 = 0;
 
+#ifdef USE_SIMD
+	ret = mpg123_synth_ntom(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1, fr);
+#else
 	ret = mpg123_synth_ntom(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1);
+#endif
 	samples += *pnt;
 
 	for (i = 0; i < (pnt1 >> 21); i++)
@@ -88,14 +104,22 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_ntom_8bit_mono2stereo(real * bandPtr, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_ntom_8bit_mono2stereo(real * bandPtr, unsigned char *samples, int *pnt)
+#endif
 {
 	short samples_tmp[8 * 64];
 	short *tmp1 = samples_tmp;
 	int i, ret;
 	int pnt1 = 0;
 
+#ifdef USE_SIMD
+	ret = mpg123_synth_ntom(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1, fr);
+#else
 	ret = mpg123_synth_ntom(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1);
+#endif
 	samples += *pnt;
 
 	for (i = 0; i < (pnt1 >> 2); i++)
@@ -109,14 +133,22 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_ntom_mono(real * bandPtr, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_ntom_mono(real * bandPtr, unsigned char *samples, int *pnt)
+#endif
 {
 	short samples_tmp[8 * 64];
 	short *tmp1 = samples_tmp;
 	int i, ret;
 	int pnt1 = 0;
 
+#ifdef USE_SIMD
+	ret = mpg123_synth_ntom(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1, fr);
+#else
 	ret = mpg123_synth_ntom(bandPtr, 0, (unsigned char *) samples_tmp, &pnt1);
+#endif
 	samples += *pnt;
 
 	for (i = 0; i < (pnt1 >> 2); i++)
@@ -130,12 +162,20 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_ntom_mono2stereo(real * bandPtr, unsigned char *samples, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_ntom_mono2stereo(real * bandPtr, unsigned char *samples, int *pnt)
+#endif
 {
 	int i, ret;
 	int pnt1 = *pnt;
 
+#ifdef USE_SIMD
+	ret = mpg123_synth_ntom(bandPtr, 0, samples, pnt, fr);
+#else
 	ret = mpg123_synth_ntom(bandPtr, 0, samples, pnt);
+#endif
 	samples += pnt1;
 
 	for (i = 0; i < ((*pnt - pnt1) >> 2); i++)
@@ -147,7 +187,11 @@
 	return ret;
 }
 
+#ifdef USE_SIMD
+int mpg123_synth_ntom(real * bandPtr, int channel, unsigned char *out, int *pnt, struct frame *fr)
+#else
 int mpg123_synth_ntom(real * bandPtr, int channel, unsigned char *out, int *pnt)
+#endif
 {
 	static real buffs[2][2][0x110];
 	static const int step = 2;
diff -urN xmms-1.2.7.orig/Input/mpg123/getcpuflags.s xmms-1.2.7/Input/mpg123/getcpuflags.s
--- xmms-1.2.7.orig/Input/mpg123/getcpuflags.s	Mon Oct  2 18:50:58 2000
+++ xmms-1.2.7/Input/mpg123/getcpuflags.s	Thu Jan  1 09:00:00 1970
@@ -1,49 +0,0 @@
-// getcpuflags.s - get CPUFLAGS
-// KIMURA Takuhiro <kim@hannah.ipc.miyakyo-u.ac.jp> - until 31.Mar.1999
-//                 <kim@comtec.co.jp>               - after  1.Apr.1999
-
-// extern int getcpuid(void) 
-// -> 0x00000000 (CPUID instruction not supported)
-// or CPUFLAGS
-
-.text
-	.align 4
-.globl mpg123_getcpuflags
-	.type	 mpg123_getcpuflags,@function
-mpg123_getcpuflags:
-	pushl %ebp
-	movl %esp,%ebp
-	subl $4,%esp
-	pushl %edx
-	pushl %ecx
-	pushl %ebx
-	movl $0x80000000,%eax 
-	
-	pushfl
-	pushfl
-	popl %eax
-	movl %eax,%ebx
-	xorl $0x00200000,%eax
-	pushl %eax
-	popfl
-	pushfl
-	popl %eax
-	popfl
-	cmpl %ebx,%eax
-	/ for detect 3DNow! support (bit 31)
-	movl $0x80000001,%eax
-	cpuid
-	movl %edx,%eax
-	jmp .L1
-	.align 4
-.L0:	
-	movl $0,%eax
-	.align 4
-.L1:
-	movl %eax,-4(%esp)
-	popl %ebx
-	popl %ecx
-	popl %edx
-	movl %ebp,%esp
-	popl %ebp
-	ret
diff -urN xmms-1.2.7.orig/Input/mpg123/layer1.c xmms-1.2.7/Input/mpg123/layer1.c
--- xmms-1.2.7.orig/Input/mpg123/layer1.c	Wed Aug  2 20:47:50 2000
+++ xmms-1.2.7/Input/mpg123/layer1.c	Wed Mar  6 00:55:41 2002
@@ -158,14 +158,23 @@
 
 		if (single >= 0)
 		{
+#ifdef USE_SIMD
+			(fr->synth_mono) ((real *) fraction[single], mpg123_pcm_sample, &mpg123_pcm_point, fr);
+#else
 			(fr->synth_mono) ((real *) fraction[single], mpg123_pcm_sample, &mpg123_pcm_point);
+#endif
 		}
 		else
 		{
 			int p1 = mpg123_pcm_point;
 
+#ifdef USE_SIMD
+			(fr->synth) ((real *) fraction[0], 0, mpg123_pcm_sample, &p1, fr);
+			(fr->synth) ((real *) fraction[1], 1, mpg123_pcm_sample, &mpg123_pcm_point, fr);
+#else
 			(fr->synth) ((real *) fraction[0], 0, mpg123_pcm_sample, &p1);
 			(fr->synth) ((real *) fraction[1], 1, mpg123_pcm_sample, &mpg123_pcm_point);
+#endif
 		}
 
 		if (mpg123_info->output_audio)
diff -urN xmms-1.2.7.orig/Input/mpg123/layer2.c xmms-1.2.7/Input/mpg123/layer2.c
--- xmms-1.2.7.orig/Input/mpg123/layer2.c	Wed Jan  2 23:21:21 2002
+++ xmms-1.2.7/Input/mpg123/layer2.c	Wed Mar  6 00:55:41 2002
@@ -58,8 +58,13 @@
 	for (k = 0; k < 27; k++)
 	{
 		double m = mulmul[k];
-
 		table = mpg123_muls[k];
+#ifdef USE_SIMD
+     if ( (mpg123_cfg.downsample == 0) && (mpg123_cfg.simd_synth == 1) )
+	       for(j = 3, i = 0; i < 63; i++, j--)
+	         *table++ = 16384 * m * pow(2.0,(double) j / 3.0);
+	   else
+#endif
 		for (j = 3, i = 0; i < 63; i++, j--)
 			*table++ = m * pow(2.0, (double) j / 3.0);
 		*table++ = 0.0;
@@ -302,14 +307,23 @@
 		{
 			if (single >= 0)
 			{
+#ifdef USE_SIMD
+				(fr->synth_mono) (fraction[single][j], mpg123_pcm_sample, &mpg123_pcm_point, fr);
+#else
 				(fr->synth_mono) (fraction[single][j], mpg123_pcm_sample, &mpg123_pcm_point);
+#endif
 			}
 			else
 			{
 				int p1 = mpg123_pcm_point;
 
+#ifdef USE_SIMD
+				(fr->synth) (fraction[0][j], 0, mpg123_pcm_sample, &p1, fr);
+				(fr->synth) (fraction[1][j], 1, mpg123_pcm_sample, &mpg123_pcm_point, fr);
+#else
 				(fr->synth) (fraction[0][j], 0, mpg123_pcm_sample, &p1);
 				(fr->synth) (fraction[1][j], 1, mpg123_pcm_sample, &mpg123_pcm_point);
+#endif
 			}
 
 			/*    if(mpg123_pcm_point >= audiobufsize)
diff -urN xmms-1.2.7.orig/Input/mpg123/layer3.c xmms-1.2.7/Input/mpg123/layer3.c
--- xmms-1.2.7.orig/Input/mpg123/layer3.c	Fri Jan  4 23:12:13 2002
+++ xmms-1.2.7/Input/mpg123/layer3.c	Wed Mar  6 00:55:41 2002
@@ -116,9 +116,16 @@
 {
 	int i, j, k, l;
 
-	for (i = -256; i < 118 + 4; i++)
+#ifdef USE_SIMD
+     if ( (mpg123_cfg.downsample == 0) && (mpg123_cfg.simd_synth == 1) )
+	for (i = -256; i < 118 + 4; i++) {
+		gainpow2[i + 256] = 16384.0 * pow((double) 2.0, -0.25 * (double) (i + 210));
+	}
+     else
+#endif
+	for (i = -256; i < 118 + 4; i++) {
 		gainpow2[i + 256] = pow((double) 2.0, -0.25 * (double) (i + 210));
-
+	}
 	for (i = 0; i < 8207; i++)
 		ispow[i] = pow((double) i, (double) 4.0 / 3.0);
 
@@ -1366,7 +1373,7 @@
 /*                                                                  */
 /*------------------------------------------------------------------*/
 
-#ifdef USE_3DNOW
+#ifdef USE_SIMD
 void dct36(real *inbuf,real *o1,real *o2,real *wintab,real *tsbuf)
 #else
 static void dct36(real * inbuf, real * o1, real * o2, real * wintab, real * tsbuf)
@@ -1863,7 +1870,7 @@
 	if (gr_info->mixed_block_flag)
 	{
 		sb = 2;
-#ifdef USE_3DNOW
+#ifdef USE_SIMD
 	     (fr->dct36)(fsIn[0],rawout1,rawout2,win[0],tspnt);
 	     (fr->dct36)(fsIn[1],rawout1+18,rawout2+18,win1[0],tspnt+1);
 #else
@@ -1888,7 +1895,7 @@
 	{
 		for (; sb < gr_info->maxb; sb += 2, tspnt += 2, rawout1 += 36, rawout2 += 36)
 		{
-#ifdef USE_3DNOW
+#ifdef USE_SIMD
 			(fr->dct36)(fsIn[sb],rawout1,rawout2,win[bt],tspnt);
 			(fr->dct36)(fsIn[sb+1],rawout1+18,rawout2+18,win1[bt],tspnt+1);
 #else
@@ -2066,14 +2073,23 @@
 		{
 			if (single >= 0)
 			{
+#ifdef USE_SIMD
+				(fr->synth_mono) (hybridOut[0][ss], mpg123_pcm_sample, &mpg123_pcm_point, fr);
+#else
 				(fr->synth_mono) (hybridOut[0][ss], mpg123_pcm_sample, &mpg123_pcm_point);
+#endif
 			}
 			else
 			{
 				int p1 = mpg123_pcm_point;
 
+#ifdef USE_SIMD
+				(fr->synth) (hybridOut[0][ss], 0, mpg123_pcm_sample, &p1, fr);
+				(fr->synth) (hybridOut[1][ss], 1, mpg123_pcm_sample, &mpg123_pcm_point, fr);
+#else
 				(fr->synth) (hybridOut[0][ss], 0, mpg123_pcm_sample, &p1);
 				(fr->synth) (hybridOut[1][ss], 1, mpg123_pcm_sample, &mpg123_pcm_point);
+#endif
 			}
 		}
 
diff -urN xmms-1.2.7.orig/Input/mpg123/mpg123.c xmms-1.2.7/Input/mpg123/mpg123.c
--- xmms-1.2.7.orig/Input/mpg123/mpg123.c	Wed Feb 20 23:17:31 2002
+++ xmms-1.2.7/Input/mpg123/mpg123.c	Wed Mar  6 00:55:41 2002
@@ -78,21 +78,20 @@
 
 void set_mpg123_synth_functions(struct frame *fr)
 {
+#ifdef USE_SIMD
+	typedef int (*func) (real *, int, unsigned char *, int *, struct frame *fr);
+	typedef int (*func_mono) (real *, unsigned char *, int *, struct frame *fr);
+	typedef int (*func1to1) (real *, int, unsigned char *, int *, struct frame *fr);
+	typedef void (*func_dct36)(real *,real *,real *,real *,real *);
+#else
 	typedef int (*func) (real *, int, unsigned char *, int *);
 	typedef int (*func_mono) (real *, unsigned char *, int *);
-#ifdef USE_3DNOW
-	typedef void (*func_dct36)(real *,real *,real *,real *,real *);
 #endif
 	int ds = fr->down_sample;
 	int p8 = 0;
 
-#ifdef USE_3DNOW
-	static func funcs[3][4] =
-	{
-#else
-	static func funcs[2][4] =
+	static func funcs[][4] =
 	{
-#endif
 		{mpg123_synth_1to1,
 		 mpg123_synth_2to1,
 		 mpg123_synth_4to1,
@@ -101,7 +100,11 @@
 		 mpg123_synth_2to1_8bit,
 		 mpg123_synth_4to1_8bit,
 		 mpg123_synth_ntom_8bit}
-#ifdef USE_3DNOW
+#ifdef USE_SIMD
+  	       ,{ mpg123_synth_1to1_mmx,
+  		  mpg123_synth_2to1,
+ 		  mpg123_synth_4to1,
+  		  mpg123_synth_ntom }
   	       ,{ mpg123_synth_1to1_3dnow,
   		  mpg123_synth_2to1,
  		  mpg123_synth_4to1,
@@ -131,7 +134,14 @@
 			 mpg123_synth_ntom_8bit_mono}}
 	};
 
-#ifdef USE_3DNOW	
+#ifdef USE_SIMD
+	static func1to1 funcs_1to1[] =
+	{
+		mpg123_synth_1to1,
+		mpg123_synth_1to1_mmx,
+		mpg123_synth_1to1_3dnow	/* synth_1to1_3dnow ? */
+	};
+
 	static func_dct36 funcs_dct36[2] = {dct36 , dct36_3dnow};
 #endif
 
@@ -140,20 +150,29 @@
 	fr->synth = funcs[p8][ds];
 	fr->synth_mono = funcs_mono[1][p8][ds];
 
-#ifdef USE_3DNOW
-       /* check cpuflags bit 31 (3DNow!) */
-	if( (mpg123_cfg.use_3dnow < 2 ) && 
-	    ((mpg123_cfg.use_3dnow == 1 ) ||
-	     (support_3dnow() == TRUE)) &&
-	    (mpg123_cfg.resolution != 8) )
+#ifdef USE_SIMD
+	mpg123_cfg.simd_synth = 0;
+	fr->dct36 = funcs_dct36[0];
+   
+       /* decide to use 3DNow! decoder */
+	if( (mpg123_cfg.select_simd == MODE_3DNOW ) || 
+	    ((mpg123_cfg.select_simd == MODE_AUTO ) &&
+	     (mpg123_cfg.stat_simd == CPU_HAS_3DNOW)) )
 	{
-		fr->synth = funcs[2][ds]; /* 3DNow! optimized synth_1to1() */
+		fr->synth = funcs[3][ds]; /* 3DNow! optimized synth_1to1() */
 		fr->dct36 = funcs_dct36[1]; /* 3DNow! optimized dct36() */
+		mpg123_cfg.simd_synth = 2;
 	}
-	else
+
+       /* decide to use MMX decoder */
+	else if ( (mpg123_cfg.select_simd == MODE_MMX ) ||
+		  ((mpg123_cfg.select_simd == MODE_AUTO ) &&
+		   ((mpg123_cfg.stat_simd == CPU_HAS_MMX) || (mpg123_cfg.stat_simd == CPU_HAS_SSE))) )
 	{
-		fr->dct36 = funcs_dct36[0];
+		fr->synth = funcs[2][ds]; /* MMX optimized synth_1to1() */
+		mpg123_cfg.simd_synth = 1;
 	}
+	fr->synth1to1 = funcs_1to1[mpg123_cfg.simd_synth];
 #endif
 	if (p8)
 	{
@@ -165,8 +184,6 @@
 {
 	ConfigFile *cfg;
 
-	mpg123_make_decode_tables(outscale);
-
 	mpg123_cfg.resolution = 16;
 	mpg123_cfg.channels = 2;
 	mpg123_cfg.downsample = 0;
@@ -182,7 +199,9 @@
 	mpg123_cfg.title_override = FALSE;
 	mpg123_cfg.disable_id3v2 = FALSE;
 	mpg123_cfg.detect_by_content = FALSE;
-	mpg123_cfg.use_3dnow = 0;
+#ifdef USE_SIMD
+	mpg123_cfg.stat_simd = mpg123_check_x86simd();
+#endif
 
 	cfg = xmms_cfg_open_default_file();
 
@@ -211,7 +230,11 @@
 	if (!xmms_cfg_read_string(cfg, "MPG123", "id3_format", &mpg123_cfg.id3_format))
 		mpg123_cfg.id3_format = g_strdup("%p - %t");
 	xmms_cfg_read_boolean(cfg, "MPG123", "detect_by_content", &mpg123_cfg.detect_by_content);
-	xmms_cfg_read_int(cfg, "MPG123", "use_3dnow", &mpg123_cfg.use_3dnow);
+#ifdef USE_SIMD
+		if (!xmms_cfg_read_int(cfg, "MPG123", "select_simd", &mpg123_cfg.select_simd)) 
+			mpg123_cfg.select_simd = MODE_AUTO;
+#endif
+	mpg123_make_decode_tables(outscale);
 
 	xmms_cfg_free(cfg);
 }
diff -urN xmms-1.2.7.orig/Input/mpg123/mpg123.h xmms-1.2.7/Input/mpg123/mpg123.h
--- xmms-1.2.7.orig/Input/mpg123/mpg123.h	Wed Feb 20 23:17:31 2002
+++ xmms-1.2.7/Input/mpg123/mpg123.h	Wed Mar  6 00:55:41 2002
@@ -19,6 +19,15 @@
 
 #include <math.h>
 
+#ifdef USE_SIMD
+#include "check_x86simd.h"
+
+#define MODE_3DNOW 2
+#define MODE_MMX   1
+#define MODE_FPU  -1
+#define MODE_AUTO  0
+#endif
+
 #include <gtk/gtk.h>
 
 #include "xmms/plugin.h"
@@ -95,10 +104,14 @@
 struct frame
 {
 	struct al_table *alloc;
+#ifdef USE_SIMD
+	int (*synth) (real *, int, unsigned char *, int *, struct frame *fr);
+	int (*synth_mono) (real *, unsigned char *, int *, struct frame *fr);
+	int (*synth1to1) (real *, int, unsigned char *, int *, struct frame *fr);
+	void (*dct36)(real *,real *,real *,real *,real *);
+#else
 	int (*synth) (real *, int, unsigned char *, int *);
 	int (*synth_mono) (real *, unsigned char *, int *);
-#ifdef USE_3DNOW
-	void (*dct36)(real *,real *,real *,real *,real *);
 #endif
 	int stereo;
 	int jsbound;
@@ -146,7 +159,11 @@
 	gchar *id3_format;
 	gboolean title_override, disable_id3v2;
 	gboolean detect_by_content;
-        gint use_3dnow;
+#ifdef USE_SIMD
+	gint select_simd; /* automatic or user define 3DNow!/MMX/FPU code */
+	gint stat_simd;  /* result of detection CPU has 3DNow!/MMX */
+	gint simd_synth;  
+#endif
 }
 MPG123Config;
 
@@ -233,6 +250,43 @@
 extern int mpg123_synth_1to1_pent(real *, int, unsigned char *);
 
 #endif
+#ifdef USE_SIMD /* x86 SIMD (3DNow!/MMX) optimizations */
+extern int mpg123_synth_1to1(real *, int, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_1to1_8bit(real *, int, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_1to1_mono(real *, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_1to1_mono2stereo(real *, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_1to1_8bit_mono(real *, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_1to1_8bit_mono2stereo(real *, unsigned char *, int *, struct frame *fr);
+
+extern int mpg123_synth_2to1(real *, int, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_2to1_8bit(real *, int, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_2to1_mono(real *, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_2to1_mono2stereo(real *, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_2to1_8bit_mono(real *, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_2to1_8bit_mono2stereo(real *, unsigned char *, int *, struct frame *fr);
+
+extern int mpg123_synth_4to1(real *, int, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_4to1_8bit(real *, int, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_4to1_mono(real *, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_4to1_mono2stereo(real *, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_4to1_8bit_mono(real *, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_4to1_8bit_mono2stereo(real *, unsigned char *, int *, struct frame *fr);
+
+extern int mpg123_synth_ntom(real *, int, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_ntom_8bit(real *, int, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_ntom_mono(real *, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_ntom_mono2stereo(real *, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_ntom_8bit_mono(real *, unsigned char *, int *, struct frame *fr);
+extern int mpg123_synth_ntom_8bit_mono2stereo(real *, unsigned char *, int *, struct frame *fr);
+
+extern void dct36(real *,real *,real *,real *,real *);
+extern void dct36_3dnow(real *,real *,real *,real *,real *);
+extern int mpg123_synth_1to1_3dnow(real *,int,unsigned char *,int *, struct frame *fr);
+
+extern void mpg123_dct64_mmx(real *,real *,real *);
+extern int mpg123_synth_1to1_mmx(real *, int, unsigned char *, int *, struct frame *fr);
+
+#else	/* ! USE_SIMD */
 extern int mpg123_synth_1to1(real *, int, unsigned char *, int *);
 extern int mpg123_synth_1to1_8bit(real *, int, unsigned char *, int *);
 extern int mpg123_synth_1to1_mono(real *, unsigned char *, int *);
@@ -260,15 +314,7 @@
 extern int mpg123_synth_ntom_mono2stereo(real *, unsigned char *, int *);
 extern int mpg123_synth_ntom_8bit_mono(real *, unsigned char *, int *);
 extern int mpg123_synth_ntom_8bit_mono2stereo(real *, unsigned char *, int *);
-
-/* 3DNow! optimizations */
-#ifdef USE_3DNOW
-extern int mpg123_getcpuflags(void);
-extern int support_3dnow(void);
-extern void dct36(real *,real *,real *,real *,real *);
-extern void dct36_3dnow(real *,real *,real *,real *,real *);
-extern int mpg123_synth_1to1_3dnow(real *,int,unsigned char *,int *);
-#endif
+#endif 	/* end of USE_SIMD */
 
 extern void mpg123_rewindNbits(int bits);
 extern int mpg123_hsstell(void);
diff -urN xmms-1.2.7.orig/Input/mpg123/tabinit.c xmms-1.2.7/Input/mpg123/tabinit.c
--- xmms-1.2.7.orig/Input/mpg123/tabinit.c	Fri Jun  1 22:07:48 2001
+++ xmms-1.2.7/Input/mpg123/tabinit.c	Wed Mar  6 00:55:41 2002
@@ -40,7 +40,34 @@
 	64019, 65290, 66494, 67629, 68692, 69679, 70590, 71420, 72169, 72835,
 	73415, 73908, 74313, 74630, 74856, 74992, 75038};
 
+#ifdef USE_SIMD
+void mpg123_make_decode_tables_fpu(long scaleval);
+void mpg123_make_decode_tables_mmx(long scaleval);
+
 void mpg123_make_decode_tables(long scaleval)
+{
+	if (mpg123_cfg.select_simd == MODE_MMX)
+  	  mpg123_make_decode_tables_mmx(scaleval);
+	else
+	  if (mpg123_cfg.select_simd == MODE_AUTO) {
+	     switch (mpg123_cfg.stat_simd) {
+		case CPU_HAS_SSE:
+		case CPU_HAS_MMX:
+		  mpg123_make_decode_tables_mmx(scaleval);
+		  break;
+		default: /* use normal decode_tables routine for 3DNow! mode */
+		  mpg123_make_decode_tables_fpu(scaleval);
+		  break;
+	     }
+	  } else {
+	     mpg123_make_decode_tables_fpu(scaleval);
+	  }
+}
+
+void mpg123_make_decode_tables_fpu(long scaleval)
+#else
+void mpg123_make_decode_tables(long scaleval)
+#endif  
 {
 	int i, j, k, kr, divv;
 	real *table, *costab;
diff -urN xmms-1.2.7.orig/Input/mpg123/tabinit_MMX.s xmms-1.2.7/Input/mpg123/tabinit_MMX.s
--- xmms-1.2.7.orig/Input/mpg123/tabinit_MMX.s	Thu Jan  1 09:00:00 1970
+++ xmms-1.2.7/Input/mpg123/tabinit_MMX.s	Wed Mar  6 00:55:41 2002
@@ -0,0 +1,160 @@
+.bss
+	.align 32
+    	.comm	mpg123_decwin,2176,32
+	.align 32
+	.comm	mpg123_decwins,2176,32
+
+.data
+	.align 32
+intwinbase_mmx:
+	.value      0,    -1,    -1,    -1,    -1,    -1,    -1,    -2
+	.value     -2,    -2,    -2,    -3,    -3,    -4,    -4,    -5
+	.value     -5,    -6,    -7,    -7,    -8,    -9,   -10,   -11
+	.value    -13,   -14,   -16,   -17,   -19,   -21,   -24,   -26
+	.value    -29,   -31,   -35,   -38,   -41,   -45,   -49,   -53
+	.value    -58,   -63,   -68,   -73,   -79,   -85,   -91,   -97
+	.value   -104,  -111,  -117,  -125,  -132,  -139,  -147,  -154
+	.value   -161,  -169,  -176,  -183,  -190,  -196,  -202,  -208
+	.value   -213,  -218,  -222,  -225,  -227,  -228,  -228,  -227
+	.value   -224,  -221,  -215,  -208,  -200,  -189,  -177,  -163
+	.value   -146,  -127,  -106,   -83,   -57,   -29,     2,    36
+	.value     72,   111,   153,   197,   244,   294,   347,   401
+	.value    459,   519,   581,   645,   711,   779,   848,   919
+	.value    991,  1064,  1137,  1210,  1283,  1356,  1428,  1498
+	.value   1567,  1634,  1698,  1759,  1817,  1870,  1919,  1962
+	.value   2001,  2032,  2057,  2075,  2085,  2087,  2080,  2063
+	.value   2037,  2000,  1952,  1893,  1822,  1739,  1644,  1535
+	.value   1414,  1280,  1131,   970,   794,   605,   402,   185
+	.value    -45,  -288,  -545,  -814, -1095, -1388, -1692, -2006
+	.value  -2330, -2663, -3004, -3351, -3705, -4063, -4425, -4788
+	.value  -5153, -5517, -5879, -6237, -6589, -6935, -7271, -7597
+	.value  -7910, -8209, -8491, -8755, -8998, -9219, -9416, -9585
+	.value  -9727, -9838, -9916, -9959, -9966, -9935, -9863, -9750
+	.value  -9592, -9389, -9139, -8840, -8492, -8092, -7640, -7134
+	.value  -6574, -5959, -5288, -4561, -3776, -2935, -2037, -1082
+	.value    -70,   998,  2122,  3300,  4533,  5818,  7154,  8540
+	.value   9975, 11455, 12980, 14548, 16155, 17799, 19478, 21189
+	.value  22929, 24694, 26482, 28289, 30112, 31947,-26209,-24360
+	.value -22511,-20664,-18824,-16994,-15179,-13383,-11610, -9863
+	.value  -8147, -6466, -4822, -3222, -1667,  -162,  1289,  2684
+	.value   4019,  5290,  6494,  7629,  8692,  9679, 10590, 11420
+	.value  12169, 12835, 13415, 13908, 14313, 14630, 14856, 14992
+	.value  15038
+
+intwindiv:
+	.long 0x47800000			# 65536.0
+.text
+	.align 32
+.globl mpg123_make_decode_tables_mmx
+
+mpg123_make_decode_tables_mmx:
+	pushl %edi
+	pushl %esi
+	pushl %ebx
+
+	xorl %ecx,%ecx
+	xorl %ebx,%ebx
+	movl $32,%esi
+	movl $intwinbase_mmx,%edi
+	negl 16(%esp)				# scaleval
+	pushl $2				# intwinbase_mmx step
+.L00:
+	cmpl $528,%ecx
+	jnc .L02
+	movswl (%edi),%eax
+	cmpl $intwinbase_mmx+444,%edi
+	jc .L01
+	addl $60000,%eax
+.L01:
+	pushl %eax
+	fildl (%esp)
+	fdivs intwindiv
+	fimull 24(%esp)
+	popl %eax
+	fsts  mpg123_decwin(,%ecx,4)
+	fstps mpg123_decwin+64(,%ecx,4)
+.L02:
+	leal -1(%esi),%edx
+	and %ebx,%edx
+	cmp $31,%edx
+	jnz .L03
+	addl $-1023,%ecx
+	test %esi,%ebx
+	jz  .L03
+	negl 20(%esp)
+.L03:
+	addl %esi,%ecx
+	addl (%esp),%edi
+	incl %ebx
+	cmpl $intwinbase_mmx,%edi
+	jz .L04
+	cmp $256,%ebx
+	jnz .L00
+	negl (%esp)
+	jmp .L00
+.L04:
+	popl %eax
+
+	xorl %ecx,%ecx
+	xorl %ebx,%ebx
+	pushl $2
+.L05:
+	cmpl $528,%ecx
+	jnc .L11
+	movswl (%edi),%eax
+	cmpl $intwinbase_mmx+444,%edi
+	jc .L06
+	addl $60000,%eax
+.L06:
+	cltd
+	imull 20(%esp)
+	shrdl $17,%edx,%eax
+	cmpl $32767,%eax
+	movl $1055,%edx
+	jle .L07
+	movl $32767,%eax
+	jmp .L08
+.L07:
+	cmpl $-32767,%eax
+	jge .L08
+	movl $-32767,%eax
+.L08:
+	cmpl $512,%ecx
+	jnc .L09
+	subl %ecx,%edx
+	movw %ax,mpg123_decwins(,%edx,2)
+	movw %ax,mpg123_decwins-32(,%edx,2)
+.L09:
+	testl $1,%ecx
+	jnz .L10
+	negl %eax
+.L10:
+	movw %ax,mpg123_decwins(,%ecx,2)
+	movw %ax,mpg123_decwins+32(,%ecx,2)
+.L11:
+	leal -1(%esi),%edx
+	and %ebx,%edx
+	cmp $31,%edx
+	jnz .L12
+	addl $-1023,%ecx
+	test %esi,%ebx
+	jz  .L12
+	negl 20(%esp)
+.L12:
+	addl %esi,%ecx
+	addl (%esp),%edi
+	incl %ebx
+	cmpl $intwinbase_mmx,%edi
+	jz .L13
+	cmp $256,%ebx
+	jnz .L05
+	negl (%esp)
+	jmp .L05
+.L13:
+	popl %eax
+	
+	popl %ebx
+	popl %esi
+	popl %edi
+	ret
+
diff -urN xmms-1.2.7.orig/Makefile.in xmms-1.2.7/Makefile.in
--- xmms-1.2.7.orig/Makefile.in	Tue Mar  5 06:58:22 2002
+++ xmms-1.2.7/Makefile.in	Wed Mar  6 00:55:41 2002
@@ -138,7 +138,7 @@
 SIDPLAY_LIBS = @SIDPLAY_LIBS@
 SM_LIBS = @SM_LIBS@
 STRIP = @STRIP@
-USE_3DNOW_TRUE = @USE_3DNOW_TRUE@
+USE_SIMD_TRUE = @USE_SIMD_TRUE@
 USE_INCLUDED_LIBINTL = @USE_INCLUDED_LIBINTL@
 USE_NLS = @USE_NLS@
 VERSION = @VERSION@
diff -urN xmms-1.2.7.orig/acconfig.h xmms-1.2.7/acconfig.h
--- xmms-1.2.7.orig/acconfig.h	Fri Nov 16 23:39:01 2001
+++ xmms-1.2.7/acconfig.h	Wed Mar  6 00:55:41 2002
@@ -56,7 +56,7 @@
 #undef HAVE_SOUND
 #undef PACKAGE
 #undef VERSION
-#undef USE_3DNOW
+#undef USE_SIMD
 #undef WITH_SYMBOL_UNDERSCORE
 #undef WITH_SM
 #undef ENABLE_NLS
diff -urN xmms-1.2.7.orig/config.h.in xmms-1.2.7/config.h.in
--- xmms-1.2.7.orig/config.h.in	Tue Mar  5 06:56:50 2002
+++ xmms-1.2.7/config.h.in	Wed Mar  6 00:55:41 2002
@@ -103,7 +103,7 @@
 #undef HAVE_SOUND
 #undef PACKAGE
 #undef VERSION
-#undef USE_3DNOW
+#undef USE_SIMD
 #undef WITH_SYMBOL_UNDERSCORE
 #undef WITH_SM
 #undef ENABLE_NLS
diff -urN xmms-1.2.7.orig/configure xmms-1.2.7/configure
--- xmms-1.2.7.orig/configure	Tue Mar  5 06:57:01 2002
+++ xmms-1.2.7/configure	Wed Mar  6 00:55:41 2002
@@ -255,7 +255,7 @@
 ac_help="$ac_help
   --with-catgets          use catgets functions if available"
 ac_help="$ac_help
-  --enable-3dnow	  build with 3DNow! instructions support"
+  --enable-simd 	           build with x86 SIMD(3DNow!/MMX) instructions support (default=no)"
 
 # Initialize some variables set by options.
 # The variables have the same names as the options, with
@@ -10597,28 +10597,28 @@
 
 
 
-# Check whether --enable-3dnow or --disable-3dnow was given.
-if test "${enable_3dnow+set}" = set; then
-  enableval="$enable_3dnow"
-  USE_3DNOW=$enableval
+# Check whether --enable-simd or --disable-simd was given.
+if test "${enable_simd+set}" = set; then
+  enableval="$enable_simd"
+  USE_SIMD=$enableval
 else
-  USE_3DNOW=no
+  USE_SIMD=no
 fi
 
-if test "x$USE_3DNOW" = xyes; then
+if test "x$USE_SIMD" = xyes; then
   cat >> confdefs.h <<\EOF
-#define USE_3DNOW 1
+#define USE_SIMD 1
 EOF
 
 fi
 
 
-if test "x$USE_3DNOW" = xyes; then
-  USE_3DNOW_TRUE=
-  USE_3DNOW_FALSE='#'
+if test "x$USE_SIMD" = xyes; then
+  USE_SIMD_TRUE=
+  USE_SIMD_FALSE='#'
 else
-  USE_3DNOW_TRUE='#'
-  USE_3DNOW_FALSE=
+  USE_SIMD_TRUE='#'
+  USE_SIMD_FALSE=
 fi
 
 
@@ -12252,8 +12252,8 @@
 s%@INPUT_PLUGINS@%$INPUT_PLUGINS%g
 s%@OUTPUT_PLUGINS@%$OUTPUT_PLUGINS%g
 s%@VISUALIZATION_PLUGINS@%$VISUALIZATION_PLUGINS%g
-s%@USE_3DNOW_TRUE@%$USE_3DNOW_TRUE%g
-s%@USE_3DNOW_FALSE@%$USE_3DNOW_FALSE%g
+s%@USE_SIMD_TRUE@%$USE_SIMD_TRUE%g
+s%@USE_SIMD_FALSE@%$USE_SIMD_FALSE%g
 s%@OSS_CFLAGS@%$OSS_CFLAGS%g
 s%@POSIX_LIBS@%$POSIX_LIBS%g
 s%@HAVE_OSS_TRUE@%$HAVE_OSS_TRUE%g
diff -urN xmms-1.2.7.orig/configure.in xmms-1.2.7/configure.in
--- xmms-1.2.7.orig/configure.in	Tue Mar  5 06:50:26 2002
+++ xmms-1.2.7/configure.in	Wed Mar  6 00:55:41 2002
@@ -328,16 +328,16 @@
 AC_SUBST(VISUALIZATION_PLUGINS)
 
 
-dnl 3DNow! instructions support
+dnl x86 SIMD(3DNow!/MMX) instructions support
 dnl ========================
-AC_ARG_ENABLE(3dnow,
-	[  --enable-3dnow	  build with 3DNow! instructions support],
-			USE_3DNOW=$enableval, USE_3DNOW=no)
-if test "x$USE_3DNOW" = xyes; then
-  AC_DEFINE(USE_3DNOW)
+AC_ARG_ENABLE(simd,
+	[  --enable-simd	  build with x86 SIMD(3DNow!/MMX) instructions support (default=no)],
+			USE_SIMD=$enableval, USE_SIMD=no)
+if test "x$USE_SIMD" = xyes; then
+  AC_DEFINE(USE_SIMD)
 fi
-AM_CONDITIONAL(USE_3DNOW,test "x$USE_3DNOW" = xyes)
-AC_SUBST(USE_3DNOW_TRUE)
+AM_CONDITIONAL(USE_SIMD,test "x$USE_SIMD" = xyes)
+AC_SUBST(USE_SIMD_TRUE)
 dnl ========================
 
 AC_CACHE_CHECK(for socklen_t, xmms_cv_type_socklen_t,
diff -urN xmms-1.2.7.orig/xmms/about.c xmms-1.2.7/xmms/about.c
--- xmms-1.2.7.orig/xmms/about.c	Wed Jan 16 23:11:55 2002
+++ xmms-1.2.7/xmms/about.c	Wed Mar  6 00:55:41 2002
@@ -45,11 +45,12 @@
 	N_("Logan Hanks"),
 	N_("Eric L. Hernes (FreeBSD patches)"),
 	N_("Ville Herva"),
+	N_("higway (MMX)"),
         N_("Michael Hipp and others (MPG123 engine)"),
 /* for languages that can't display 'a diaeresis' () replace it with "ae" */
 	N_("Olle Hllns (compiling fixes)"),
         N_("David Jacoby"),
-	N_("Osamu Kayasono (3DNow!)"),
+	N_("Osamu Kayasono (3DNow!/MMX)"),
 	N_("Lyle B Kempler"),
 	N_("J. Nick Koston (MikMod plugin)"),
 	N_("Aaron Lehmann"),
